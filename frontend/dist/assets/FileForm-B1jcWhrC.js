import{c as h,p as E,r as m,o as T,b as d,f as l,q as R,v as j,d as i,g as o,x as B,e as g,t as C,A as S,s as b,n as U,i as N,h as c,j as r}from"./index-CSrMWdAq.js";import{s as M}from"./index-B-d2rpup.js";import{s as p}from"./index-C0yZiWtw.js";import{s as O}from"./index-C6bmKOCC.js";import{s as y}from"./index-DIrNIlJG.js";import"./index-BWv2no9g.js";import"./index-L9OCDMB-.js";import"./index-BjPz2555.js";import"./index-CbCO2FIF.js";const Y={class:"max-w-2xl mx-auto space-y-6"},I={class:"card bg-white dark:bg-surface-800 rounded-xl shadow-sm p-6"},z={key:0,class:"space-y-6"},G={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},P={class:"flex flex-col gap-2"},H={class:"grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-4"},J={class:"flex flex-col gap-2"},K={class:"flex flex-col gap-2"},Q={class:"flex flex-col gap-2"},W={key:0,class:"text-red-600 text-xs mt-1"},X={key:0,class:"flex flex-col gap-2"},Z={key:0,class:"flex items-center gap-2"},ee={class:"px-3 py-1 bg-surface-200 dark:bg-surface-700 rounded text-surface-900 dark:text-surface-100"},te={class:"flex flex-col gap-2"},se={class:"flex flex-col gap-2"},le={class:"flex flex-col gap-2"},ae={class:"flex flex-col gap-2"},oe={key:0,for:"status",class:"text-sm font-medium text-surface-700 dark:text-surface-200"},ie={class:"flex flex-col gap-2 md:col-span-2"},re={class:"flex justify-end gap-3"},_e={__name:"FileForm",setup(ne){const k=N(),f=E(),u=h(()=>!!f.params.id),_=m(!1),V=m(!!f.params.id),w=m([]),v=m([]);h(()=>[{id:null,name:"Unassigned"},...v.value]);const A=["Income Tax","GST","Audit","Accounting","Consulting"],F=["received","assigned","in-progress","ready-to-file","filed","completed"],$=[{key:"AB",label:"Above 2 Crores"},{key:"AD",label:"1 to 2 Crores"},{key:"NR",label:"Less than 1 Crore"},{key:"LA",label:"Less than 50 Lakhs"}],s=m({client_id:null,file_type:"",assessment_year:"",financial_year:"",status:"received",assigned_to:null,turnover:null,estimated_completion_date:null,notes:""}),D=async()=>{try{const[a,e]=await Promise.all([c.get("/clients"),c.get("/employees")]);if(w.value=a.data,v.value=e.data,u.value){const n=await c.get(`/files/${f.params.id}`);s.value=n.data}}catch(a){console.error("Error fetching data:",a)}finally{V.value=!1}},L=a=>{if(!a)return null;const e=new Date(a),n=""+(e.getMonth()+1),t=""+e.getDate();return[e.getFullYear(),n.padStart(2,"0"),t.padStart(2,"0")].join("-")},x=m({}),q=async()=>{_.value=!0,x.value={};try{const a={...s.value};u.value||(a.status="received"),a.estimated_completion_date&&(a.estimated_completion_date=L(a.estimated_completion_date)),u.value?await c.put(`/files/${f.params.id}`,a):await c.post("/files",a),k.push("/files")}catch(a){a.response&&a.response.data&&a.response.data.errors?x.value=Object.fromEntries(Object.entries(a.response.data.errors).map(([e,n])=>[e,n[0]])):console.error("Error saving file:",a)}finally{_.value=!1}};return T(()=>{D()}),(a,e)=>{var n;return r(),d("div",Y,[l("div",I,[V.value?(r(),d("div",z,[l("div",G,[(r(),d(R,null,j(7,t=>l("div",{key:t,class:"flex flex-col gap-2"},[i(o(y),{width:"6rem",height:"1rem"}),i(o(y),{width:"100%",height:"2.5rem"})])),64))]),l("div",P,[i(o(y),{width:"4rem",height:"1rem"}),i(o(y),{width:"100%",height:"4rem"})])])):(r(),d("form",{key:1,onSubmit:B(q,["prevent"]),class:"space-y-6"},[l("div",H,[l("div",J,[e[11]||(e[11]=l("label",{for:"client",class:"text-sm font-medium text-surface-700 dark:text-surface-200"},"Client",-1)),i(o(p),{id:"client",modelValue:s.value.client_id,"onUpdate:modelValue":e[0]||(e[0]=t=>s.value.client_id=t),options:w.value,optionLabel:"business_name",optionValue:"id",placeholder:"Select Client",filter:"",required:"",class:"w-full"},null,8,["modelValue","options"])]),l("div",K,[e[12]||(e[12]=l("label",{for:"file_type",class:"text-sm font-medium text-surface-700 dark:text-surface-200"},"File Type",-1)),i(o(p),{id:"file_type",modelValue:s.value.file_type,"onUpdate:modelValue":e[1]||(e[1]=t=>s.value.file_type=t),options:A,placeholder:"Select Type",required:"",class:"w-full"},null,8,["modelValue"])]),l("div",Q,[e[13]||(e[13]=l("label",{for:"turnover",class:"text-sm font-medium text-surface-700 dark:text-surface-200"},"Turnover *",-1)),i(o(p),{id:"turnover",modelValue:s.value.turnover,"onUpdate:modelValue":e[2]||(e[2]=t=>s.value.turnover=t),options:$,optionLabel:"label",optionValue:"key",placeholder:"Select Turnover",required:"",class:"w-full"},null,8,["modelValue"]),x.value.turnover?(r(),d("span",W,C(x.value.turnover),1)):g("",!0)]),u.value?(r(),d("div",X,[e[14]||(e[14]=l("label",{for:"assignee",class:"text-sm font-medium text-surface-700 dark:text-surface-200"},"Assignee",-1)),s.value.assigned_to?(r(),d("div",Z,[l("span",ee,C(((n=v.value.find(t=>t.id===s.value.assigned_to))==null?void 0:n.name)||"Unknown"),1),i(o(b),{icon:"pi pi-times",size:"small",text:"",rounded:"",onClick:e[3]||(e[3]=t=>s.value.assigned_to=null),"aria-label":"Clear Assignee"})])):(r(),S(o(p),{key:1,id:"assignee",modelValue:s.value.assigned_to,"onUpdate:modelValue":e[4]||(e[4]=t=>s.value.assigned_to=t),options:v.value,optionLabel:"name",optionValue:"id",placeholder:"Select Employee",filter:"",class:"w-full"},null,8,["modelValue","options"]))])):g("",!0),l("div",te,[e[15]||(e[15]=l("label",{for:"assessment_year",class:"text-sm font-medium text-surface-700 dark:text-surface-200"},"Assessment Year",-1)),i(o(U),{id:"assessment_year",modelValue:s.value.assessment_year,"onUpdate:modelValue":e[5]||(e[5]=t=>s.value.assessment_year=t),placeholder:"e.g. 2024-2025",required:""},null,8,["modelValue"])]),l("div",se,[e[16]||(e[16]=l("label",{for:"financial_year",class:"text-sm font-medium text-surface-700 dark:text-surface-200"},"Financial Year",-1)),i(o(U),{id:"financial_year",modelValue:s.value.financial_year,"onUpdate:modelValue":e[6]||(e[6]=t=>s.value.financial_year=t),placeholder:"e.g. 2023-2024"},null,8,["modelValue"])]),l("div",le,[e[17]||(e[17]=l("label",{for:"estimated_completion_date",class:"text-sm font-medium text-surface-700 dark:text-surface-200"},"Estimated Completion Date *",-1)),i(o(O),{id:"estimated_completion_date",modelValue:s.value.estimated_completion_date,"onUpdate:modelValue":e[7]||(e[7]=t=>s.value.estimated_completion_date=t),dateFormat:"yy-mm-dd",showIcon:"",required:"",class:"w-full"},null,8,["modelValue"])]),l("div",ae,[u.value?(r(),d("label",oe,"Status")):g("",!0),u.value?(r(),S(o(p),{key:1,id:"status",modelValue:s.value.status,"onUpdate:modelValue":e[8]||(e[8]=t=>s.value.status=t),options:F,placeholder:"Select Status",required:"",class:"w-full"},null,8,["modelValue"])):g("",!0)]),l("div",ie,[e[18]||(e[18]=l("label",{for:"notes",class:"text-sm font-medium text-surface-700 dark:text-surface-200"},"Notes",-1)),i(o(M),{id:"notes",modelValue:s.value.notes,"onUpdate:modelValue":e[9]||(e[9]=t=>s.value.notes=t),rows:"3"},null,8,["modelValue"])])]),l("div",re,[i(o(b),{label:"Cancel",severity:"secondary",onClick:e[10]||(e[10]=t=>o(k).back())}),i(o(b),{type:"submit",label:u.value?"Update File":"Create File",loading:_.value},null,8,["label","loading"])])],32))])])}}};export{_e as default};
