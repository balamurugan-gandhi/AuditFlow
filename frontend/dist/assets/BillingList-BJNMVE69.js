import{r,c as A,o as T,b as I,f as l,d as s,w as i,g as a,i as M,s as m,h as V,j as b,n as $,k as E,t as _,m as F,e as N,A as j,ap as q}from"./index-BZGgFshJ.js";import{s as G,a as d}from"./index-DsU-KCdk.js";import{s as O}from"./index-CfJVsdKT.js";import{s as Q}from"./index-CMiJpnI6.js";import{s as z}from"./index-96xtCJkb.js";import{s as H}from"./index-CcGyZ6li.js";import{s as J,a as K}from"./index-D5pn4_TF.js";import"./index-DzdNdXKe.js";import"./index-1NqfiXxy.js";const W={class:"space-y-6"},X={class:"flex justify-between items-center gap-4"},Y={class:"flex gap-3"},Z={class:"card bg-white dark:bg-surface-800 rounded-xl shadow-sm p-4"},ee={class:"flex gap-2"},te={key:0,class:"space-y-4"},ae={class:"p-3 bg-surface-50 dark:bg-surface-700 rounded-md mb-4"},se={class:"text-sm text-surface-600 dark:text-surface-300"},oe={class:"text-xl font-bold text-surface-900 dark:text-surface-0"},le={class:"flex flex-col gap-2"},ne={class:"flex flex-col gap-2"},re={class:"flex flex-col gap-2"},_e={__name:"BillingList",setup(ie){const S=q,h=M(),f=r([]),x=r(!0),p=r(""),u=r(!1),y=r(!1),c=r(null),D=["Bank Transfer","Cash","Cheque","UPI"],n=r({amount:0,payment_date:new Date().toISOString().split("T")[0],payment_method:""}),R=A(()=>{if(!p.value)return f.value;const o=p.value.toLowerCase();return f.value.filter(e=>{var t,v,C,k;return((t=e.invoice_number)==null?void 0:t.toLowerCase().includes(o))||((C=(v=e.client)==null?void 0:v.business_name)==null?void 0:C.toLowerCase().includes(o))||((k=e.status)==null?void 0:k.toLowerCase().includes(o))})}),g=async()=>{try{const o=await V.get("/invoices");f.value=o.data}catch(o){console.error("Error fetching invoices:",o)}finally{x.value=!1}},B=o=>{c.value=o,n.value.amount=o.auditor_fee,u.value=!0},L=async()=>{y.value=!0;try{await V.post(`/invoices/${c.value.id}/payments`,{amount:n.value.amount,payment_date:n.value.payment_date,payment_method:n.value.payment_method.toLowerCase().replace(" ","_")}),u.value=!1,await g()}catch(o){console.error("Error recording payment:",o)}finally{y.value=!1}},P=o=>{h.push(`/billing/${o.id}`)},U=o=>{switch(o){case"paid":return"success";case"partial":return"warning";case"overdue":return"danger";default:return"secondary"}},w=o=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR"}).format(o);return T(()=>{g()}),(o,e)=>(b(),I("div",W,[l("div",X,[e[7]||(e[7]=l("h2",{class:"text-2xl font-bold text-surface-900 dark:text-surface-0 m-0"},"All Invoices",-1)),l("div",Y,[s(a(J),{iconPosition:"left"},{default:i(()=>[s(a(K),{class:"pi pi-search"}),s(a($),{modelValue:p.value,"onUpdate:modelValue":e[0]||(e[0]=t=>p.value=t),placeholder:"Search invoices...",style:{width:"300px"}},null,8,["modelValue"])]),_:1}),s(a(m),{label:"Create Invoice",icon:"pi pi-plus",onClick:e[1]||(e[1]=t=>a(h).push("/billing/create"))})])]),l("div",Z,[s(a(G),{value:R.value,loading:x.value,paginator:"",rows:10,tableStyle:"min-width: 50rem",stripedRows:"",showGridlines:!1,class:"p-datatable-sm"},{default:i(()=>[s(a(d),{field:"invoice_number",header:"Invoice #",sortable:""}),s(a(d),{field:"client.business_name",header:"Client",sortable:""}),s(a(d),{field:"file.file_number",header:"File ID",sortable:""}),s(a(d),{field:"invoice_date",header:"Date",sortable:""}),s(a(d),{field:"auditor_fee",header:"Amount",sortable:""},{body:i(t=>[E(_(w(t.data.auditor_fee)),1)]),_:1}),s(a(d),{header:"Status"},{body:i(t=>[s(a(O),{value:t.data.status,severity:U(t.data.status)},null,8,["value","severity"])]),_:1}),s(a(d),{header:"Actions"},{body:i(t=>[l("div",ee,[t.data.status!=="paid"?F((b(),j(a(m),{key:0,icon:"pi pi-dollar",text:"",rounded:"",severity:"success",onClick:v=>B(t.data)},null,8,["onClick"])),[[a(S),"Record Payment"]]):N("",!0),s(a(m),{icon:"pi pi-eye",text:"",rounded:"",severity:"secondary",onClick:v=>P(t.data)},null,8,["onClick"])])]),_:1})]),_:1},8,["value","loading"])]),s(a(Q),{visible:u.value,"onUpdate:visible":e[6]||(e[6]=t=>u.value=t),modal:"",header:"Record Payment",style:{width:"30rem"}},{footer:i(()=>[s(a(m),{label:"Cancel",text:"",severity:"secondary",onClick:e[5]||(e[5]=t=>u.value=!1)}),s(a(m),{label:"Record Payment",onClick:L,loading:y.value},null,8,["loading"])]),default:i(()=>[c.value?(b(),I("div",te,[l("div",ae,[l("p",se,"Invoice #"+_(c.value.invoice_number),1),l("p",oe,_(w(c.value.auditor_fee)),1)]),l("div",le,[e[8]||(e[8]=l("label",{for:"amount",class:"text-sm font-medium"},"Amount",-1)),s(a(z),{id:"amount",modelValue:n.value.amount,"onUpdate:modelValue":e[2]||(e[2]=t=>n.value.amount=t),mode:"currency",currency:"INR",locale:"en-IN",class:"w-full"},null,8,["modelValue"])]),l("div",ne,[e[9]||(e[9]=l("label",{for:"date",class:"text-sm font-medium"},"Date",-1)),s(a($),{id:"date",type:"date",modelValue:n.value.payment_date,"onUpdate:modelValue":e[3]||(e[3]=t=>n.value.payment_date=t),class:"w-full"},null,8,["modelValue"])]),l("div",re,[e[10]||(e[10]=l("label",{for:"method",class:"text-sm font-medium"},"Method",-1)),s(a(H),{id:"method",modelValue:n.value.payment_method,"onUpdate:modelValue":e[4]||(e[4]=t=>n.value.payment_method=t),options:D,placeholder:"Select Method",class:"w-full"},null,8,["modelValue"])])])):N("",!0)]),_:1},8,["visible"])]))}};export{_e as default};
