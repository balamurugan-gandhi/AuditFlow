import{r as n,F as B,k as I,c as g,a as l,b as s,l as o,f as t,g as v,h as L,m as G,o as x,t as w,w as _,s as d,n as T,e as j}from"./index-CERIRcW2.js";import{s as D,a as r}from"./index-XVpHQhPD.js";import{s as K,a as O}from"./index-U7OHyoop.js";import{s as F}from"./index-DSoLdR8G.js";import{s as Z}from"./index-BSCWIYhD.js";import"./index-yWIa-DpI.js";import"./index-DBcSeseI.js";import"./index-CUPv0TyI.js";const q={class:"space-y-6"},z={class:"card bg-white dark:bg-surface-800 rounded-xl shadow-sm p-4 border border-surface-200 dark:border-surface-700"},H={class:"flex justify-between items-center mb-4"},J={class:"flex gap-2"},Q={key:0},W={key:1,class:"text-surface-400 italic"},X={class:"flex gap-2"},Y={class:"flex align-items-center gap-2"},P={class:"mb-4"},ee={class:"flex flex-column gap-4"},ce={__name:"ClientList",setup(te){const b=L(),k=n([]),N=n(!0),u=n({global:{value:null,matchMode:B.CONTAINS}}),p=n(null),C=n(!1),h=n(null),$=n([]),f=n(!1),c=n(!1),m=n({reason:""}),V=async()=>{try{const i=await v.get("/clients");k.value=i.data}catch(i){console.error("Error fetching clients:",i)}finally{N.value=!1}},E=async i=>{if(confirm(`Are you sure you want to delete ${i.business_name}?`)){p.value=i.id;try{await v.delete(`/clients/${i.id}`),await V()}catch(e){console.error("Error deleting client:",e)}finally{p.value=null}}},U=async i=>{f.value=!0;try{const e=await v.get(`/clients/${i}/notes`);$.value=e.data}catch(e){console.error("Error fetching client notes:",e)}finally{f.value=!1}},M=()=>{m.value={reason:""},c.value=!0},R=async()=>{try{await v.post(`/clients/${h.value.id}/notes`,m.value),c.value=!1,await U(h.value.id)}catch(i){console.error("Error saving note:",i)}},S=i=>i?new Date(i).toLocaleString("en-IN",{timeZone:"Asia/Kolkata",year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"-";return I(()=>{V()}),(i,e)=>{const y=G("tooltip");return x(),g("div",q,[l("div",z,[s(t(D),{filters:u.value,"onUpdate:filters":e[2]||(e[2]=a=>u.value=a),value:k.value,loading:N.value,paginator:"",rows:10,globalFilterFields:["business_name","contact_person","email","pan_number","phone"],tableStyle:"min-width: 50rem",stripedRows:"",showGridlines:!1,class:"p-datatable-sm"},{header:o(()=>[l("div",H,[e[7]||(e[7]=l("h3",{class:"text-xl font-bold text-surface-900 dark:text-surface-0 m-0"},"Clients",-1)),l("div",J,[s(t(K),{iconPosition:"left"},{default:o(()=>[s(t(O),{class:"pi pi-search"}),s(t(T),{modelValue:u.value.global.value,"onUpdate:modelValue":e[0]||(e[0]=a=>u.value.global.value=a),placeholder:"Search clients..."},null,8,["modelValue"])]),_:1}),s(t(d),{label:"Add Client",icon:"pi pi-plus",onClick:e[1]||(e[1]=a=>t(b).push("/clients/create")),severity:"primary"})])])]),empty:o(()=>[...e[8]||(e[8]=[l("div",{class:"text-center p-4"},"No clients found.",-1)])]),default:o(()=>[s(t(r),{field:"business_name",header:"Business Name",sortable:"",class:"font-medium"}),s(t(r),{field:"pan_number",header:"PAN Number",sortable:""}),s(t(r),{field:"contact_person",header:"Contact Person",sortable:""}),s(t(r),{field:"phone",header:"Phone"}),s(t(r),{field:"email",header:"File ID",sortable:""},{body:o(a=>[a.data.file_id?(x(),g("span",Q,w(a.data.file_id),1)):(x(),g("span",W,"N/A"))]),_:1}),s(t(r),{header:"Actions",exportable:!1,style:{"min-width":"8rem"}},{body:o(a=>[l("div",X,[_(s(t(d),{icon:"pi pi-eye",text:"",rounded:"",severity:"secondary",onClick:A=>t(b).push(`/clients/${a.data.id}`)},null,8,["onClick"]),[[y,"View",void 0,{top:!0}]]),_(s(t(d),{icon:"pi pi-pencil",text:"",rounded:"",severity:"info",onClick:A=>t(b).push(`/clients/${a.data.id}/edit`)},null,8,["onClick"]),[[y,"Edit",void 0,{top:!0}]]),_(s(t(d),{icon:"pi pi-trash",text:"",rounded:"",severity:"danger",onClick:A=>E(a.data),loading:p.value===a.data.id,disabled:p.value===a.data.id},null,8,["onClick","loading","disabled"]),[[y,"Delete",void 0,{top:!0}]])])]),_:1})]),_:1},8,["filters","value","loading"])]),s(t(F),{visible:C.value,"onUpdate:visible":e[3]||(e[3]=a=>C.value=a),modal:"",header:"Client Notes",style:{width:"50rem"}},{header:o(()=>{var a;return[l("div",Y,[e[9]||(e[9]=l("i",{class:"pi pi-file"},null,-1)),l("span",null,"Notes for "+w((a=h.value)==null?void 0:a.business_name),1)])]}),default:o(()=>[l("div",P,[s(t(d),{label:"Add Note",icon:"pi pi-plus",onClick:M})]),s(t(D),{value:$.value,loading:f.value,stripedRows:"",showGridlines:!1,class:"p-datatable-sm"},{empty:o(()=>[...e[10]||(e[10]=[l("div",{class:"text-center p-4"},[l("i",{class:"pi pi-info-circle text-4xl text-surface-400 mb-4"}),l("h3",{class:"text-xl font-semibold text-surface-700 dark:text-surface-300 mb-2"},"No Notes Found"),l("p",{class:"text-surface-500 dark:text-surface-400"}," No notes have been added for this client yet. ")],-1)])]),default:o(()=>[s(t(r),{field:"reason",header:"Reason",style:{"min-width":"200px"}}),s(t(r),{field:"user.name",header:"User",style:{"min-width":"120px"}}),s(t(r),{field:"created_at",header:"Last Contacted",style:{"min-width":"120px"}},{body:o(a=>[j(w(S(a.data.created_at)),1)]),_:1})]),_:1},8,["value","loading"])]),_:1},8,["visible"]),s(t(F),{visible:c.value,"onUpdate:visible":e[6]||(e[6]=a=>c.value=a),modal:"",header:"Add Note",style:{width:"30rem"}},{footer:o(()=>[s(t(d),{label:"Cancel",icon:"pi pi-times",text:"",onClick:e[5]||(e[5]=a=>c.value=!1)}),s(t(d),{label:"Save",icon:"pi pi-check",onClick:R,loading:f.value},null,8,["loading"])]),default:o(()=>[l("div",ee,[l("div",null,[e[11]||(e[11]=l("label",{for:"reason",class:"block text-sm font-medium mb-2"},"Reason *",-1)),s(t(Z),{id:"reason",modelValue:m.value.reason,"onUpdate:modelValue":e[4]||(e[4]=a=>m.value.reason=a),rows:"4",class:"w-full"},null,8,["modelValue"])])])]),_:1},8,["visible"])])}}};export{ce as default};
