import{r as c,a as P,o as I,b as m,d as n,f as a,g as r,x as g,n as u,e as w,m as M,A as _,s as h,t as b,B as U,k as A,q as C,v as R,h as V,l as $,j as d}from"./index-CSrMWdAq.js";import{s as z}from"./index-xGG4egpC.js";import{s as q}from"./index-B-d2rpup.js";import{s as L}from"./index-DHUl35ms.js";import"./index-L9OCDMB-.js";const O={class:"max-w-4xl mx-auto space-y-6"},K={class:"card bg-white dark:bg-surface-800 rounded-xl shadow-sm p-6"},G={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},H={class:"flex flex-col gap-2"},Q={class:"flex flex-col gap-2"},W={class:"flex flex-col gap-2"},J={class:"flex flex-col gap-2"},X={class:"flex flex-col gap-2"},Y={class:"flex flex-col gap-2"},Z={class:"flex flex-col gap-2"},ee={class:"flex flex-col gap-2"},ae={class:"flex flex-col gap-2"},se={class:"flex flex-col gap-2"},te={key:0,class:"flex flex-col items-center gap-2"},le=["src"],oe={key:1,class:"flex flex-col items-center gap-2 text-surface-400"},re={key:0,class:"mt-2 text-xs text-surface-500 dark:text-surface-400"},ne={class:"flex flex-col gap-2 md:col-span-2"},de={class:"flex justify-end"},ie={class:"card bg-white dark:bg-surface-800 rounded-xl shadow-sm p-6 border border-surface-200 dark:border-surface-700"},ue={key:0,class:"space-y-4"},ce={key:0,class:"p-4 bg-red-50 dark:bg-red-900/10 border border-red-200 dark:border-red-800 rounded-lg text-red-600 dark:text-red-400 text-sm"},me={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},pe={class:"p-4 bg-surface-50 dark:bg-surface-900 rounded-lg border border-surface-100 dark:border-surface-700"},fe={class:"text-lg font-bold text-surface-900 dark:text-surface-0 mt-1"},xe={class:"p-4 bg-surface-50 dark:bg-surface-900 rounded-lg border border-surface-100 dark:border-surface-700"},be={class:"flex items-center gap-2 mt-1"},ve={class:"text-lg font-bold text-surface-900 dark:text-surface-0"},ge={class:"p-4 bg-surface-50 dark:bg-surface-900 rounded-lg border border-surface-100 dark:border-surface-700"},_e={class:"flex items-center gap-2 mt-1 font-mono text-sm break-all text-surface-700 dark:text-surface-300"},ye={class:"flex flex-wrap gap-2 mt-2"},ke={key:1,class:"text-center py-4 text-surface-500"},we={class:"card bg-white dark:bg-surface-800 rounded-xl shadow-sm p-6 border border-surface-200 dark:border-surface-700"},he={class:"space-y-4"},Ve={class:"flex items-center justify-between p-4 bg-surface-50 dark:bg-surface-900 rounded-xl border border-surface-100 dark:border-surface-700 gap-4"},Se={__name:"Settings",setup(Le){const y=c(!1);c(!1);const k=c(!1),i=c(null),f=P(),S=c({whatsapp_access_token:"",whatsapp_phone_number_id:"",whatsapp_business_account_id:""}),s=c({company_name:"",contact_name:"",email:"",phone:"",whatsapp:"",address:"",logo:"",gst_number:"",pan_number:"",tan_number:"",license_number:""}),x=c(""),p=c(null);function F(){x.value="",p.value=null}function T(o){const e=o.dataTransfer.files[0];e&&D({target:{files:[e]}})}const B=async()=>{try{const o=await V.get("/settings"),e=o.data.settings;i.value=o.data.license,S.value={whatsapp_access_token:e.whatsapp_access_token||"",whatsapp_phone_number_id:e.whatsapp_phone_number_id||"",whatsapp_business_account_id:e.whatsapp_business_account_id||""},s.value={company_name:e.company_name||"",contact_name:e.company_contact_name||"",email:e.company_email||"",phone:e.company_phone||"",whatsapp:e.company_whatsapp||"",address:e.company_address||"",logo:e.company_logo||"",gst_number:e.gst_number||"",pan_number:e.pan_number||"",tan_number:e.tan_number||"",license_number:e.license_number||""},s.value.logo&&(x.value=`${"/api".replace("/api","")}/storage/${s.value.logo}`)}catch(o){console.error("Error fetching settings:",o),f.add({severity:"error",summary:"Error",detail:"Failed to load settings",life:3e3})}},D=o=>{const e=o.target.files[0];if(e){if(e.size>10485760){f.add({severity:"error",summary:"File Too Large",detail:"The logo file is too large. Please upload an image smaller than 10MB.",life:5e3}),o.target.value="";return}p.value=e;const t=new FileReader;t.onload=v=>{x.value=v.target.result},t.readAsDataURL(e)}},E=async()=>{var o,e;k.value=!0;try{const l=new FormData;l.append("company_name",s.value.company_name),l.append("company_contact_name",s.value.contact_name),l.append("company_email",s.value.email),l.append("company_phone",s.value.phone),l.append("company_whatsapp",s.value.whatsapp),l.append("company_address",s.value.address),l.append("gst_number",s.value.gst_number),l.append("pan_number",s.value.pan_number),l.append("tan_number",s.value.tan_number),l.append("license_number",s.value.license_number),p.value&&l.append("company_logo",p.value),await V.post("/settings",l,{headers:{"Content-Type":"multipart/form-data"}}),f.add({severity:"success",summary:"Success",detail:"Company information saved successfully",life:3e3})}catch(l){console.error("Error saving company info:",l),((o=l.response)==null?void 0:o.status)===413?f.add({severity:"error",summary:"File Too Large",detail:"The logo file is too large. Please upload an image smaller than 10MB.",life:5e3}):((e=l.response)==null?void 0:e.status)===422?f.add({severity:"error",summary:"Validation Error",detail:"Please check your input and try again.",life:3e3}):f.add({severity:"error",summary:"Error",detail:"Failed to save company information. Please try again.",life:3e3})}finally{k.value=!1}},j=async()=>{y.value=!0;try{const o=await V.get("/backup/download",{responseType:"blob"}),e=window.URL.createObjectURL(new Blob([o.data])),l=document.createElement("a");l.href=e;const t=o.headers["content-disposition"];let v="backup.sql";if(t){const N=t.match(/filename="?([^"]+)"?/);N.length===2&&(v=N[1])}else v=`backup-${new Date().toISOString().slice(0,19).replace(/:/g,"-")}.sql`;l.setAttribute("download",v),document.body.appendChild(l),l.click(),document.body.removeChild(l),window.URL.revokeObjectURL(e)}catch(o){console.error("Backup download failed:",o),alert("Failed to download backup. Please try again.")}finally{y.value=!1}};return I(()=>{B()}),(o,e)=>{const l=$("tooltip");return d(),m(C,null,[n(r(z)),a("div",O,[a("div",K,[e[24]||(e[24]=a("h2",{class:"text-xl font-bold text-surface-900 dark:text-surface-0 mb-6"},"Company Information",-1)),a("form",{onSubmit:g(E,["prevent"]),class:"space-y-6"},[a("div",G,[a("div",H,[e[11]||(e[11]=a("label",{for:"company_name",class:"text-sm font-medium text-surface-700 dark:text-surface-200"},"Company Name",-1)),n(r(u),{id:"company_name",modelValue:s.value.company_name,"onUpdate:modelValue":e[0]||(e[0]=t=>s.value.company_name=t)},null,8,["modelValue"])]),a("div",Q,[e[12]||(e[12]=a("label",{for:"contact_name",class:"text-sm font-medium text-surface-700 dark:text-surface-200"},"Contact Name",-1)),n(r(u),{id:"contact_name",modelValue:s.value.contact_name,"onUpdate:modelValue":e[1]||(e[1]=t=>s.value.contact_name=t)},null,8,["modelValue"])]),a("div",W,[e[13]||(e[13]=a("label",{for:"company_email",class:"text-sm font-medium text-surface-700 dark:text-surface-200"},"Email",-1)),n(r(u),{id:"company_email",type:"email",modelValue:s.value.email,"onUpdate:modelValue":e[2]||(e[2]=t=>s.value.email=t)},null,8,["modelValue"])]),a("div",J,[e[14]||(e[14]=a("label",{for:"company_phone",class:"text-sm font-medium text-surface-700 dark:text-surface-200"},"Phone",-1)),n(r(u),{id:"company_phone",modelValue:s.value.phone,"onUpdate:modelValue":e[3]||(e[3]=t=>s.value.phone=t)},null,8,["modelValue"])]),a("div",X,[e[15]||(e[15]=a("label",{for:"company_whatsapp",class:"text-sm font-medium text-surface-700 dark:text-surface-200"},"WhatsApp",-1)),n(r(u),{id:"company_whatsapp",modelValue:s.value.whatsapp,"onUpdate:modelValue":e[4]||(e[4]=t=>s.value.whatsapp=t)},null,8,["modelValue"])]),a("div",Y,[e[16]||(e[16]=a("label",{for:"gst_number",class:"text-sm font-medium text-surface-700 dark:text-surface-200"},"GST Number",-1)),n(r(u),{id:"gst_number",modelValue:s.value.gst_number,"onUpdate:modelValue":e[5]||(e[5]=t=>s.value.gst_number=t)},null,8,["modelValue"])]),a("div",Z,[e[17]||(e[17]=a("label",{for:"pan_number",class:"text-sm font-medium text-surface-700 dark:text-surface-200"},"PAN Number",-1)),n(r(u),{id:"pan_number",modelValue:s.value.pan_number,"onUpdate:modelValue":e[6]||(e[6]=t=>s.value.pan_number=t)},null,8,["modelValue"])]),a("div",ee,[e[18]||(e[18]=a("label",{for:"tan_number",class:"text-sm font-medium text-surface-700 dark:text-surface-200"},"TAN Number",-1)),n(r(u),{id:"tan_number",modelValue:s.value.tan_number,"onUpdate:modelValue":e[7]||(e[7]=t=>s.value.tan_number=t)},null,8,["modelValue"])]),a("div",ae,[e[19]||(e[19]=a("label",{for:"license_number",class:"text-sm font-medium text-surface-700 dark:text-surface-200"},"License Number",-1)),n(r(u),{id:"license_number",modelValue:s.value.license_number,"onUpdate:modelValue":e[8]||(e[8]=t=>s.value.license_number=t)},null,8,["modelValue"])]),a("div",se,[e[22]||(e[22]=a("label",{for:"company_logo",class:"text-sm font-medium text-surface-700 dark:text-surface-200"},"Logo",-1)),a("div",{class:"relative flex flex-col items-center justify-center border-2 border-dashed border-surface-200 dark:border-surface-700 rounded-lg bg-surface-50 dark:bg-surface-900 py-4 px-4 cursor-pointer transition hover:bg-primary-50",onDragover:e[9]||(e[9]=g(()=>{},["prevent"])),onDrop:g(T,["prevent"])},[a("input",{type:"file",id:"company_logo",onChange:D,accept:"image/*",class:"absolute inset-0 opacity-0 cursor-pointer",style:{"z-index":"2"}},null,32),x.value?(d(),m("div",te,[a("img",{src:x.value,alt:"Logo preview",class:"h-20 object-contain rounded border border-surface-200 dark:border-surface-700 shadow"},null,8,le),e[20]||(e[20]=a("span",{class:"text-xs text-surface-500 dark:text-surface-400"},"Preview",-1))])):(d(),m("div",oe,[...e[21]||(e[21]=[a("i",{class:"pi pi-image text-4xl"},null,-1),a("span",{class:"text-xs"},"Drag & drop or click to upload",-1)])])),x.value?M((d(),_(r(h),{key:2,icon:"pi pi-times",text:"",severity:"danger",onClick:g(F,["stop"]),class:"absolute top-2 right-2"},null,512)),[[l,"Remove logo"]]):w("",!0)],32),p.value?(d(),m("div",re,[a("span",null,b(p.value.name)+" ("+b((p.value.size/1024).toFixed(1))+" KB)",1)])):w("",!0)]),a("div",ne,[e[23]||(e[23]=a("label",{for:"company_address",class:"text-sm font-medium text-surface-700 dark:text-surface-200"},"Address",-1)),n(r(q),{id:"company_address",modelValue:s.value.address,"onUpdate:modelValue":e[10]||(e[10]=t=>s.value.address=t),rows:"3"},null,8,["modelValue"])])]),a("div",de,[n(r(h),{type:"submit",label:"Save Company Info",loading:k.value},null,8,["loading"])])],32)]),a("div",ie,[e[31]||(e[31]=U('<div class="grid grid-cols-[auto_1fr] items-center gap-4 mb-6"><div class="w-12 h-12 rounded-xl bg-purple-50 dark:bg-purple-500/10 flex items-center justify-center"><i class="pi pi-verified text-purple-500 text-xl"></i></div><div><h3 class="text-lg font-semibold text-surface-900 dark:text-surface-0 m-0 leading-tight">License Information</h3><p class="text-surface-500 dark:text-surface-400 text-sm mt-1 mb-0">AuditFlow Application License Details</p></div></div>',1)),i.value?(d(),m("div",ue,[!i.value.is_valid&&i.value.error?(d(),m("div",ce,[e[25]||(e[25]=a("i",{class:"pi pi-exclamation-triangle mr-2"},null,-1)),A(" "+b(i.value.error),1)])):w("",!0),a("div",me,[a("div",pe,[e[26]||(e[26]=a("span",{class:"text-xs font-semibold text-surface-500 dark:text-surface-400 uppercase tracking-wider"},"Licensed To",-1)),a("div",fe,b(i.value.issued_to||"N/A"),1)]),e[29]||(e[29]=a("div",{class:"p-4 bg-surface-50 dark:bg-surface-900 rounded-lg border border-surface-100 dark:border-surface-700"},[a("span",{class:"text-xs font-semibold text-surface-500 dark:text-surface-400 uppercase tracking-wider"},"Licensed From"),a("div",{class:"text-lg font-bold text-surface-900 dark:text-surface-0 mt-1"},"Klock Technologies")],-1)),a("div",xe,[e[27]||(e[27]=a("span",{class:"text-xs font-semibold text-surface-500 dark:text-surface-400 uppercase tracking-wider"},"Expiry Date",-1)),a("div",be,[a("div",ve,b(i.value.expires_at?new Date(i.value.expires_at).toLocaleDateString():"N/A"),1),i.value.is_valid?(d(),_(r(L),{key:0,value:"Active",severity:"success"})):(d(),_(r(L),{key:1,value:"Expired",severity:"danger"}))])]),a("div",ge,[e[28]||(e[28]=a("span",{class:"text-xs font-semibold text-surface-500 dark:text-surface-400 uppercase tracking-wider"},"License ID / Hash",-1)),a("div",_e,b(i.value.license_id||"N/A"),1)])]),a("div",ye,[(d(!0),m(C,null,R(i.value.features,t=>(d(),_(r(L),{key:t,value:t==="*"?"Full Access":t,severity:"info",outlined:""},null,8,["value"]))),128))])])):(d(),m("div",ke,[...e[30]||(e[30]=[a("i",{class:"pi pi-spin pi-spinner mr-2"},null,-1),A(" Loading license details... ",-1)])]))]),a("div",we,[e[33]||(e[33]=U('<div class="grid grid-cols-[auto_1fr] items-center gap-4 mb-6"><div class="w-12 h-12 rounded-xl bg-blue-50 dark:bg-blue-500/10 flex items-center justify-center"><i class="pi pi-database text-blue-500 text-xl"></i></div><div><h3 class="text-lg font-semibold text-surface-900 dark:text-surface-0 m-0 leading-tight">Database Management</h3><p class="text-surface-500 dark:text-surface-400 text-sm mt-1 mb-0">Manage your application data backups.</p></div></div>',1)),a("div",he,[a("div",Ve,[e[32]||(e[32]=a("div",null,[a("h4",{class:"font-medium text-surface-900 dark:text-surface-0 m-0 text-base"},"Backup Database"),a("p",{class:"text-sm text-surface-500 dark:text-surface-400 mt-1 mb-0"},"Download a full SQL dump")],-1)),n(r(h),{label:"Download",icon:"pi pi-download",loading:y.value,onClick:j,severity:"secondary",outlined:""},null,8,["loading"])])])])])],64)}}};export{Se as default};
