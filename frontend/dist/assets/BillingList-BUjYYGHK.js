import{r,j as T,k as A,c as I,a as o,b as s,l as i,f as a,h as M,s as m,g as V,o as b,n as $,e as q,t as _,w as E,d as N,B as F,aq as j}from"./index-CERIRcW2.js";import{s as G,a as d}from"./index-XVpHQhPD.js";import{s as O}from"./index-CFQQnXSI.js";import{s as Q}from"./index-DSoLdR8G.js";import{s as z}from"./index-yWIa-DpI.js";import{s as H}from"./index-uhg5r1Ll.js";import{s as J,a as K}from"./index-U7OHyoop.js";import"./index-DBcSeseI.js";import"./index-CUPv0TyI.js";const W={class:"space-y-6"},X={class:"flex justify-between items-center gap-4"},Y={class:"flex gap-3"},Z={class:"card bg-white dark:bg-surface-800 rounded-xl shadow-sm p-4"},ee={class:"flex gap-2"},te={key:0,class:"space-y-4"},ae={class:"p-3 bg-surface-50 dark:bg-surface-700 rounded-md mb-4"},se={class:"text-sm text-surface-600 dark:text-surface-300"},le={class:"text-xl font-bold text-surface-900 dark:text-surface-0"},oe={class:"flex flex-col gap-2"},ne={class:"flex flex-col gap-2"},re={class:"flex flex-col gap-2"},_e={__name:"BillingList",setup(ie){const S=j,h=M(),f=r([]),x=r(!0),p=r(""),u=r(!1),y=r(!1),c=r(null),D=["Bank Transfer","Cash","Cheque","UPI"],n=r({amount:0,payment_date:new Date().toISOString().split("T")[0],payment_method:""}),B=T(()=>{if(!p.value)return f.value;const l=p.value.toLowerCase();return f.value.filter(e=>{var t,v,C,k;return((t=e.invoice_number)==null?void 0:t.toLowerCase().includes(l))||((C=(v=e.client)==null?void 0:v.business_name)==null?void 0:C.toLowerCase().includes(l))||((k=e.status)==null?void 0:k.toLowerCase().includes(l))})}),g=async()=>{try{const l=await V.get("/invoices");f.value=l.data}catch(l){console.error("Error fetching invoices:",l)}finally{x.value=!1}},R=l=>{c.value=l,n.value.amount=l.auditor_fee,u.value=!0},L=async()=>{y.value=!0;try{await V.post(`/invoices/${c.value.id}/payments`,{amount:n.value.amount,payment_date:n.value.payment_date,payment_method:n.value.payment_method.toLowerCase().replace(" ","_")}),u.value=!1,await g()}catch(l){console.error("Error recording payment:",l)}finally{y.value=!1}},P=l=>{h.push(`/billing/${l.id}`)},U=l=>{switch(l){case"paid":return"success";case"partial":return"warning";case"overdue":return"danger";default:return"secondary"}},w=l=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR"}).format(l);return A(()=>{g()}),(l,e)=>(b(),I("div",W,[o("div",X,[e[7]||(e[7]=o("h2",{class:"text-2xl font-bold text-surface-900 dark:text-surface-0 m-0"},"All Invoices",-1)),o("div",Y,[s(a(J),{iconPosition:"left"},{default:i(()=>[s(a(K),{class:"pi pi-search"}),s(a($),{modelValue:p.value,"onUpdate:modelValue":e[0]||(e[0]=t=>p.value=t),placeholder:"Search invoices...",style:{width:"300px"}},null,8,["modelValue"])]),_:1}),s(a(m),{label:"Create Invoice",icon:"pi pi-plus",onClick:e[1]||(e[1]=t=>a(h).push("/billing/create"))})])]),o("div",Z,[s(a(G),{value:B.value,loading:x.value,paginator:"",rows:10,tableStyle:"min-width: 50rem",stripedRows:"",showGridlines:!1,class:"p-datatable-sm"},{default:i(()=>[s(a(d),{field:"invoice_number",header:"Invoice #",sortable:""}),s(a(d),{field:"client.business_name",header:"Client",sortable:""}),s(a(d),{field:"file.file_number",header:"File ID",sortable:""}),s(a(d),{field:"invoice_date",header:"Date",sortable:""}),s(a(d),{field:"auditor_fee",header:"Amount",sortable:""},{body:i(t=>[q(_(w(t.data.auditor_fee)),1)]),_:1}),s(a(d),{header:"Status"},{body:i(t=>[s(a(O),{value:t.data.status,severity:U(t.data.status)},null,8,["value","severity"])]),_:1}),s(a(d),{header:"Actions"},{body:i(t=>[o("div",ee,[t.data.status!=="paid"?E((b(),F(a(m),{key:0,icon:"pi pi-dollar",text:"",rounded:"",severity:"success",onClick:v=>R(t.data)},null,8,["onClick"])),[[a(S),"Record Payment"]]):N("",!0),s(a(m),{icon:"pi pi-eye",text:"",rounded:"",severity:"secondary",onClick:v=>P(t.data)},null,8,["onClick"])])]),_:1})]),_:1},8,["value","loading"])]),s(a(Q),{visible:u.value,"onUpdate:visible":e[6]||(e[6]=t=>u.value=t),modal:"",header:"Record Payment",style:{width:"30rem"}},{footer:i(()=>[s(a(m),{label:"Cancel",text:"",severity:"secondary",onClick:e[5]||(e[5]=t=>u.value=!1)}),s(a(m),{label:"Record Payment",onClick:L,loading:y.value},null,8,["loading"])]),default:i(()=>[c.value?(b(),I("div",te,[o("div",ae,[o("p",se,"Invoice #"+_(c.value.invoice_number),1),o("p",le,_(w(c.value.auditor_fee)),1)]),o("div",oe,[e[8]||(e[8]=o("label",{for:"amount",class:"text-sm font-medium"},"Amount",-1)),s(a(z),{id:"amount",modelValue:n.value.amount,"onUpdate:modelValue":e[2]||(e[2]=t=>n.value.amount=t),mode:"currency",currency:"INR",locale:"en-IN",class:"w-full"},null,8,["modelValue"])]),o("div",ne,[e[9]||(e[9]=o("label",{for:"date",class:"text-sm font-medium"},"Date",-1)),s(a($),{id:"date",type:"date",modelValue:n.value.payment_date,"onUpdate:modelValue":e[3]||(e[3]=t=>n.value.payment_date=t),class:"w-full"},null,8,["modelValue"])]),o("div",re,[e[10]||(e[10]=o("label",{for:"method",class:"text-sm font-medium"},"Method",-1)),s(a(H),{id:"method",modelValue:n.value.payment_method,"onUpdate:modelValue":e[4]||(e[4]=t=>n.value.payment_method=t),options:D,placeholder:"Select Method",class:"w-full"},null,8,["modelValue"])])])):N("",!0)]),_:1},8,["visible"])]))}};export{_e as default};
