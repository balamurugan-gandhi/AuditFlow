import{_ as U,u as B,r as u,a as j,c as T,o as q,b as a,d as c,e as b,f as s,g as r,t as d,s as F,w as k,h as w,i as z,j as l,k as H}from"./index-CSrMWdAq.js";import{s as A}from"./index-C0yZiWtw.js";import{s as N,a as v}from"./index-MuAhWHKq.js";import{s as K}from"./index-DHUl35ms.js";import{s as G}from"./index-xGG4egpC.js";import"./index-BWv2no9g.js";import"./index-L9OCDMB-.js";import"./index-CAhpMCF-.js";import"./index-CbCO2FIF.js";const J={class:"dashboard"},O={key:0,class:"mb-6 p-4 bg-red-100 border-l-4 border-red-500 text-red-700 rounded shadow-sm flex items-center justify-between"},Q={class:"flex items-center"},W={class:"text-sm m-0"},X={class:"mb-6"},Z={class:"mb-4"},ee={class:"text-3xl font-bold text-surface-900 dark:text-surface-0 m-0"},se={class:"flex gap-6 flex-wrap"},te={key:0,class:"flex items-center gap-2"},ae={class:"flex items-center gap-2"},le={class:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8"},ie={class:"card-content"},oe={key:0,class:"card-value"},ne={key:1,class:"skeleton-loader",style:{width:"80px",height:"40px"}},re={key:2,class:"card-percentage"},de={class:"percentage-badge"},ce={class:"percentage-text"},ue={key:3,class:"skeleton-loader",style:{width:"120px",height:"20px","margin-top":"8px"}},pe={class:"card-content"},ve={key:0,class:"card-value"},ge={key:1,class:"skeleton-loader",style:{width:"80px",height:"40px"}},me={key:2,class:"card-percentage"},fe={class:"percentage-badge"},ye={class:"percentage-text"},he={key:3,class:"skeleton-loader",style:{width:"120px",height:"20px","margin-top":"8px"}},_e={class:"card-content"},xe={key:0,class:"card-value"},be={key:1,class:"skeleton-loader",style:{width:"80px",height:"40px"}},ke={key:2,class:"card-percentage"},we={class:"percentage-badge"},Ce={key:3,class:"skeleton-loader",style:{width:"120px",height:"20px","margin-top":"8px"}},$e={class:"card-content"},Re={key:0,class:"card-value"},Fe={key:1,class:"skeleton-loader",style:{width:"80px",height:"40px"}},Pe={key:2,class:"card-percentage"},Ve={class:"percentage-badge"},De={key:3,class:"skeleton-loader",style:{width:"120px",height:"20px","margin-top":"8px"}},Te={class:"card-content"},Ae={key:0,class:"card-value"},Ne={key:1,class:"skeleton-loader",style:{width:"80px",height:"40px"}},Se={key:2,class:"card-percentage"},Ie={class:"percentage-badge"},Le={key:3,class:"skeleton-loader",style:{width:"120px",height:"20px","margin-top":"8px"}},Ee={class:"card-content"},Me={key:0,class:"card-value"},Ye={key:1,class:"skeleton-loader",style:{width:"80px",height:"40px"}},Ue={key:2,class:"card-percentage"},Be={class:"percentage-badge"},je={key:3,class:"skeleton-loader",style:{width:"120px",height:"20px","margin-top":"8px"}},qe={class:"card-content"},ze={key:0,class:"card-value"},He={key:1,class:"skeleton-loader",style:{width:"80px",height:"40px"}},Ke={class:"dashboard-content"},Ge={class:"content-card"},Je={class:"card-header"},Oe={class:"content-card"},Qe={class:"card-header"},We={__name:"Dashboard",setup(Xe){const f=B(),S=z(),i=u(!1),I=j(),L=T(()=>{var e,o;if(f.isAdmin){if(p.value){const x=$.value.find(m=>m.id===p.value);if(x)return`${x.name.split(" ")[0]} Dashboard`}return"Admin Dashboard"}return`${((o=(e=f.user)==null?void 0:e.name)==null?void 0:o.split(" ")[0])||"User"} Dashboard`}),y=new Date().getFullYear(),P=u([`${y}-${y+1}`,`${y-1}-${y}`,`${y-2}-${y-1}`]);u([{label:"Last 24 Hours",value:"24h"},{label:"Last 7 Days",value:"7d"},{label:"Last 30 Days",value:"30d"}]);const _=u(P.value[0]),C=u(null),$=u([]),p=u(null),t=u({received:0,total_clients:0,total_files:0,unreceived:0,pending:0,in_progress:0,ready_to_file:0,completed:0,payment_received:0,unassigned:0}),h=(n,e=!1)=>e?t.value.total_clients===0?0:Math.round(n/t.value.total_clients*100):t.value.total_files===0?0:Math.round(n/t.value.total_files*100);T(()=>[{title:"Received Files",count:t.value.received,status:"all",icon:"pi-inbox",gradient:"from-blue-500 to-blue-600",showPercentage:!0,percentageText:"of total clients",isReceivedCard:!0},{title:"Unreceived Files",count:t.value.unreceived,status:"secondary",icon:"pi-exclamation-triangle",gradient:"from-gray-500 to-gray-600",showPercentage:!0,percentageText:"of total clients",isReceivedCard:!0},{title:"Pending Files",count:t.value.pending,status:"warning",icon:"pi-clock",gradient:"from-orange-500 to-red-500",showPercentage:!0,percentageText:"of total files",isReceivedCard:!1},{title:"In Progress",count:t.value.in_progress,status:"in-progress",icon:"pi-cog",gradient:"from-indigo-500 to-purple-500",showPercentage:!0,percentageText:"of total files",isReceivedCard:!1},{title:"Ready to File",count:t.value.ready_to_file,status:"ready-to-file",icon:"pi-file",gradient:"from-cyan-500 to-blue-500",showPercentage:!0,percentageText:"of total files",isReceivedCard:!1},{title:"Completed Files",count:t.value.completed,status:"completed",icon:"pi-check-circle",gradient:"from-emerald-500 to-green-500",showPercentage:!0,percentageText:"of total files",isReceivedCard:!1},{title:"Payment Received",count:t.value.payment_received,status:"payment_received",icon:"pi-wallet",gradient:"from-teal-500 to-emerald-500",showPercentage:!1,isReceivedCard:!1}]);const V=u([]),D=u([]),R=async()=>{i.value=!0;try{const n=await w.get("/dashboard/stats",{params:{assessment_year:_.value,employee_id:p.value,time_period:C.value}});t.value=n.data;const o=(await w.get("/files")).data;V.value=o.slice(0,5),t.value.payment_received=o.filter(m=>m.status==="payment_received"&&m.payment_id!==null).length;const x=await w.get("/invoices");D.value=(x.data||[]).filter(m=>m.status==="unpaid").slice(0,5)}catch(n){console.error("Error fetching dashboard data:",n),n.response&&n.response.status===402&&I.add({severity:"error",summary:"License Required",detail:"Some features are disabled due to invalid license.",life:5e3})}finally{i.value=!1}},E=async()=>{if(f.isAdmin)try{const n=await w.get("/employees",{params:{role:"employee"}});$.value=n.data}catch(n){console.error("Error fetching employees:",n)}},g=n=>{const e={status:n,year:_.value};C.value&&(e.time_period=C.value),p.value&&(e.employee_id=p.value),S.push({path:"/files",query:e})},M=n=>new Intl.NumberFormat("en-IN").format(n),Y=n=>({received:"secondary",assigned:"info","in-progress":"info","ready-to-file":"info",filed:"success",completed:"success"})[n]||"secondary";return q(()=>{E(),R()}),(n,e)=>(l(),a("div",J,[c(r(G)),t.value.license&&!t.value.license.is_valid?(l(),a("div",O,[s("div",Q,[e[13]||(e[13]=s("i",{class:"pi pi-exclamation-triangle mr-3 text-xl"},null,-1)),s("div",null,[e[12]||(e[12]=s("p",{class:"font-bold m-0"},"License Restricted Content",-1)),s("p",W,"Application access is limited. "+d(t.value.license.error||"Please contact Klock Technologies."),1)])]),c(r(F),{label:"View License",severity:"danger",size:"small",outlined:"",onClick:e[0]||(e[0]=o=>n.$router.push("/settings"))})])):b("",!0),s("div",X,[s("div",Z,[s("h2",ee,d(L.value),1)]),s("div",se,[r(f).isAdmin?(l(),a("div",te,[e[14]||(e[14]=s("i",{class:"pi pi-users text-surface-600 dark:text-surface-400"},null,-1)),c(r(A),{modelValue:p.value,"onUpdate:modelValue":e[1]||(e[1]=o=>p.value=o),options:$.value,optionLabel:"name",optionValue:"id",placeholder:"Select Employee",class:"w-64",showClear:"",onChange:R},null,8,["modelValue","options"])])):b("",!0),s("div",ae,[e[15]||(e[15]=s("i",{class:"pi pi-calendar text-surface-600 dark:text-surface-400"},null,-1)),c(r(A),{modelValue:_.value,"onUpdate:modelValue":e[2]||(e[2]=o=>_.value=o),options:P.value,placeholder:"Select Year",class:"w-64",onChange:R},null,8,["modelValue","options"])])])]),s("div",le,[s("div",{class:"dashboard-card card-blue",onClick:e[3]||(e[3]=o=>!i.value&&g("all"))},[e[18]||(e[18]=s("div",{class:"card-bg-pattern"},null,-1)),s("div",ie,[s("div",null,[e[16]||(e[16]=s("p",{class:"card-label"},"Received Files",-1)),i.value?(l(),a("div",ne)):(l(),a("h3",oe,d(t.value.received),1)),i.value?(l(),a("div",ue)):(l(),a("div",re,[s("span",de,d(h(t.value.received,!0))+"%",1),s("span",ce,"from "+d(t.value.total_clients)+" clients",1)]))]),e[17]||(e[17]=s("div",{class:"card-icon-wrapper"},[s("i",{class:"pi pi-inbox card-icon"})],-1))])]),p.value?b("",!0):(l(),a("div",{key:0,class:"dashboard-card card-gray",onClick:e[4]||(e[4]=o=>!i.value&&g("unreceived"))},[e[21]||(e[21]=s("div",{class:"card-bg-pattern"},null,-1)),s("div",pe,[s("div",null,[e[19]||(e[19]=s("p",{class:"card-label"},"Unreceived Files",-1)),i.value?(l(),a("div",ge)):(l(),a("h3",ve,d(t.value.unreceived),1)),i.value?(l(),a("div",he)):(l(),a("div",me,[s("span",fe,d(h(t.value.unreceived,!0))+"%",1),s("span",ye,"from "+d(t.value.total_clients)+" clients",1)]))]),e[20]||(e[20]=s("div",{class:"card-icon-wrapper"},[s("i",{class:"pi pi-exclamation-triangle card-icon"})],-1))])])),s("div",{class:"dashboard-card card-orange",onClick:e[5]||(e[5]=o=>!i.value&&g("pending"))},[e[25]||(e[25]=s("div",{class:"card-bg-pattern"},null,-1)),s("div",_e,[s("div",null,[e[23]||(e[23]=s("p",{class:"card-label"},"Pending Files",-1)),i.value?(l(),a("div",be)):(l(),a("h3",xe,d(t.value.pending),1)),i.value?(l(),a("div",Ce)):(l(),a("div",ke,[s("span",we,d(h(t.value.pending,!1))+"%",1),e[22]||(e[22]=s("span",{class:"percentage-text"},"of total files",-1))]))]),e[24]||(e[24]=s("div",{class:"card-icon-wrapper"},[s("i",{class:"pi pi-clock card-icon"})],-1))])]),s("div",{class:"dashboard-card card-purple",onClick:e[6]||(e[6]=o=>!i.value&&g("in-progress"))},[e[29]||(e[29]=s("div",{class:"card-bg-pattern"},null,-1)),s("div",$e,[s("div",null,[e[27]||(e[27]=s("p",{class:"card-label"},"In Progress",-1)),i.value?(l(),a("div",Fe)):(l(),a("h3",Re,d(t.value.in_progress),1)),i.value?(l(),a("div",De)):(l(),a("div",Pe,[s("span",Ve,d(h(t.value.in_progress,!1))+"%",1),e[26]||(e[26]=s("span",{class:"percentage-text"},"of total files",-1))]))]),e[28]||(e[28]=s("div",{class:"card-icon-wrapper"},[s("i",{class:"pi pi-cog card-icon"})],-1))])]),s("div",{class:"dashboard-card card-cyan",onClick:e[7]||(e[7]=o=>!i.value&&g("ready-to-file"))},[e[33]||(e[33]=s("div",{class:"card-bg-pattern"},null,-1)),s("div",Te,[s("div",null,[e[31]||(e[31]=s("p",{class:"card-label"},"Ready to File",-1)),i.value?(l(),a("div",Ne)):(l(),a("h3",Ae,d(t.value.ready_to_file),1)),i.value?(l(),a("div",Le)):(l(),a("div",Se,[s("span",Ie,d(h(t.value.ready_to_file,!1))+"%",1),e[30]||(e[30]=s("span",{class:"percentage-text"},"of total files",-1))]))]),e[32]||(e[32]=s("div",{class:"card-icon-wrapper"},[s("i",{class:"pi pi-file card-icon"})],-1))])]),s("div",{class:"dashboard-card card-green",onClick:e[8]||(e[8]=o=>!i.value&&g("completed"))},[e[37]||(e[37]=s("div",{class:"card-bg-pattern"},null,-1)),s("div",Ee,[s("div",null,[e[35]||(e[35]=s("p",{class:"card-label"},"Completed Files",-1)),i.value?(l(),a("div",Ye)):(l(),a("h3",Me,d(t.value.completed),1)),i.value?(l(),a("div",je)):(l(),a("div",Ue,[s("span",Be,d(h(t.value.completed,!1))+"%",1),e[34]||(e[34]=s("span",{class:"percentage-text"},"of total files",-1))]))]),e[36]||(e[36]=s("div",{class:"card-icon-wrapper"},[s("i",{class:"pi pi-check-circle card-icon"})],-1))])]),r(f).isAdmin||r(f).isManager?(l(),a("div",{key:1,class:"dashboard-card card-teal",onClick:e[9]||(e[9]=o=>!i.value&&g("payment_received"))},[e[40]||(e[40]=s("div",{class:"card-bg-pattern"},null,-1)),s("div",qe,[s("div",null,[e[38]||(e[38]=s("p",{class:"card-label"},"Payment Received",-1)),i.value?(l(),a("div",He)):(l(),a("h3",ze,d(t.value.payment_received),1))]),e[39]||(e[39]=s("div",{class:"card-icon-wrapper"},[s("i",{class:"pi pi-wallet card-icon"})],-1))])])):b("",!0)]),s("div",Ke,[s("div",Ge,[s("div",Je,[e[41]||(e[41]=s("h2",null,"Recent Files",-1)),c(r(F),{label:"View All",text:"",onClick:e[10]||(e[10]=o=>n.$router.push("/files"))})]),c(r(N),{value:V.value,loading:i.value},{default:k(()=>[c(r(v),{field:"file_type",header:"File Type"}),c(r(v),{field:"client.business_name",header:"Client"}),c(r(v),{field:"assessment_year",header:"Assessment Year"}),c(r(v),{field:"status",header:"Status"},{body:k(o=>[c(r(K),{value:o.data.status,severity:Y(o.data.status)},null,8,["value","severity"])]),_:1})]),_:1},8,["value","loading"])]),s("div",Oe,[s("div",Qe,[e[42]||(e[42]=s("h2",null,"Pending Invoices",-1)),c(r(F),{label:"View All",text:"",onClick:e[11]||(e[11]=o=>n.$router.push("/billing"))})]),c(r(N),{value:D.value,loading:i.value},{default:k(()=>[c(r(v),{field:"invoice_number",header:"Invoice #"}),c(r(v),{field:"client.business_name",header:"Client"}),c(r(v),{field:"total_amount",header:"Amount"},{body:k(o=>[H(" â‚¹"+d(M(o.data.total_amount)),1)]),_:1}),c(r(v),{field:"due_date",header:"Due Date"})]),_:1},8,["value","loading"])])])]))}},rs=U(We,[["__scopeId","data-v-9595f1e4"]]);export{rs as default};
