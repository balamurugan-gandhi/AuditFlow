import{r as p,a as P,o as $,b as u,d,f as a,g as l,x as v,n as c,e as V,m as U,A as y,s as _,t as m,B as T,k,q as A,v as R,h as D,l as z,j as i}from"./index-DPOBPCwE.js";import{s as q}from"./index-BEGeOAbc.js";import{s as O}from"./index-DZuIy-g5.js";import{s as L}from"./index-n7NHwDQH.js";import"./index-DtRZ5Itz.js";const G={class:"max-w-4xl mx-auto space-y-6"},K={class:"card bg-white dark:bg-surface-800 rounded-xl shadow-sm p-6"},H={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},Q={class:"flex flex-col gap-2"},W={class:"flex flex-col gap-2"},Y={class:"flex flex-col gap-2"},J={class:"flex flex-col gap-2"},X={class:"flex flex-col gap-2"},Z={class:"flex flex-col gap-2"},ee={class:"flex flex-col gap-2"},ae={class:"flex flex-col gap-2"},te={class:"flex flex-col gap-2"},se={class:"flex flex-col gap-2"},re={key:0,class:"flex flex-col items-center gap-2"},oe=["src"],le={key:1,class:"flex flex-col items-center gap-2 text-surface-400"},ne={key:0,class:"mt-2 text-xs text-surface-500 dark:text-surface-400"},de={class:"flex flex-col gap-2 md:col-span-2"},ie={class:"flex justify-end"},ue={class:"card bg-white dark:bg-surface-800 rounded-xl shadow-sm p-6 border border-surface-200 dark:border-surface-700"},ce={key:0,class:"space-y-4"},pe={key:0,class:"p-4 bg-red-50 dark:bg-red-900/10 border border-red-200 dark:border-red-800 rounded-lg text-red-600 dark:text-red-400 text-sm"},me={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},fe={class:"p-4 bg-surface-50 dark:bg-surface-900 rounded-lg border border-surface-100 dark:border-surface-700"},xe={class:"text-lg font-bold text-surface-900 dark:text-surface-0 mt-1"},be={class:"p-4 bg-surface-50 dark:bg-surface-900 rounded-lg border border-surface-100 dark:border-surface-700"},ge={class:"flex items-center gap-2 mt-1"},ve={class:"text-lg font-bold text-surface-900 dark:text-surface-0"},ye={class:"p-4 bg-surface-50 dark:bg-surface-900 rounded-lg border border-surface-100 dark:border-surface-700"},_e={class:"flex items-center gap-2 mt-1 font-mono text-sm break-all text-surface-700 dark:text-surface-300"},ke={class:"p-4 bg-surface-50 dark:bg-surface-900 rounded-lg border border-surface-100 dark:border-surface-700"},we={key:0,class:"flex items-center gap-2 mt-1 font-mono text-sm text-surface-700 dark:text-surface-300"},he={key:1,class:"flex items-center gap-2 mt-1 text-sm text-surface-500 italic"},Ve={class:"p-4 bg-primary-50/30 dark:bg-primary-500/5 border border-primary-100 dark:border-primary-900/30 rounded-lg flex items-center justify-between gap-4 mt-4"},De={class:"flex items-center gap-3"},Le={class:"font-mono text-sm text-surface-700 dark:text-surface-300 mt-0.5"},Ce={class:"flex flex-wrap gap-2 mt-2"},Ne={key:1,class:"text-center py-4 text-surface-500"},Ue={class:"card bg-white dark:bg-surface-800 rounded-xl shadow-sm p-6 border border-surface-200 dark:border-surface-700"},Te={class:"space-y-4"},Ae={class:"flex items-center justify-between p-4 bg-surface-50 dark:bg-surface-900 rounded-xl border border-surface-100 dark:border-surface-700 gap-4"},Ee={__name:"Settings",setup(Se){const w=p(!1);p(!1);const h=p(!1),n=p(null),f=P(),S=p({whatsapp_access_token:"",whatsapp_phone_number_id:"",whatsapp_business_account_id:""}),t=p({company_name:"",contact_name:"",email:"",phone:"",whatsapp:"",address:"",logo:"",gst_number:"",pan_number:"",tan_number:"",license_number:""}),b=p(""),x=p(null),F=o=>{o&&(navigator.clipboard.writeText(o),f.add({severity:"info",summary:"Copied",detail:"Machine ID copied to clipboard",life:2e3}))};function B(){b.value="",x.value=null}function j(o){const e=o.dataTransfer.files[0];e&&C({target:{files:[e]}})}const I=async()=>{try{const o=await D.get("/settings"),e=o.data.settings;n.value=o.data.license,S.value={whatsapp_access_token:e.whatsapp_access_token||"",whatsapp_phone_number_id:e.whatsapp_phone_number_id||"",whatsapp_business_account_id:e.whatsapp_business_account_id||""},t.value={company_name:e.company_name||"",contact_name:e.company_contact_name||"",email:e.company_email||"",phone:e.company_phone||"",whatsapp:e.company_whatsapp||"",address:e.company_address||"",logo:e.company_logo||"",gst_number:e.gst_number||"",pan_number:e.pan_number||"",tan_number:e.tan_number||"",license_number:e.license_number||""},t.value.logo&&(b.value=`${"/api".replace("/api","")}/storage/${t.value.logo}`)}catch(o){console.error("Error fetching settings:",o),f.add({severity:"error",summary:"Error",detail:"Failed to load settings",life:3e3})}},C=o=>{const e=o.target.files[0];if(e){if(e.size>10485760){f.add({severity:"error",summary:"File Too Large",detail:"The logo file is too large. Please upload an image smaller than 10MB.",life:5e3}),o.target.value="";return}x.value=e;const s=new FileReader;s.onload=g=>{b.value=g.target.result},s.readAsDataURL(e)}},M=async()=>{var o,e;h.value=!0;try{const r=new FormData;r.append("company_name",t.value.company_name),r.append("company_contact_name",t.value.contact_name),r.append("company_email",t.value.email),r.append("company_phone",t.value.phone),r.append("company_whatsapp",t.value.whatsapp),r.append("company_address",t.value.address),r.append("gst_number",t.value.gst_number),r.append("pan_number",t.value.pan_number),r.append("tan_number",t.value.tan_number),r.append("license_number",t.value.license_number),x.value&&r.append("company_logo",x.value),await D.post("/settings",r,{headers:{"Content-Type":"multipart/form-data"}}),f.add({severity:"success",summary:"Success",detail:"Company information saved successfully",life:3e3})}catch(r){console.error("Error saving company info:",r),((o=r.response)==null?void 0:o.status)===413?f.add({severity:"error",summary:"File Too Large",detail:"The logo file is too large. Please upload an image smaller than 10MB.",life:5e3}):((e=r.response)==null?void 0:e.status)===422?f.add({severity:"error",summary:"Validation Error",detail:"Please check your input and try again.",life:3e3}):f.add({severity:"error",summary:"Error",detail:"Failed to save company information. Please try again.",life:3e3})}finally{h.value=!1}},E=async()=>{w.value=!0;try{const o=await D.get("/backup/download",{responseType:"blob"}),e=window.URL.createObjectURL(new Blob([o.data])),r=document.createElement("a");r.href=e;const s=o.headers["content-disposition"];let g="backup.sql";if(s){const N=s.match(/filename="?([^"]+)"?/);N.length===2&&(g=N[1])}else g=`backup-${new Date().toISOString().slice(0,19).replace(/:/g,"-")}.sql`;r.setAttribute("download",g),document.body.appendChild(r),r.click(),document.body.removeChild(r),window.URL.revokeObjectURL(e)}catch(o){console.error("Backup download failed:",o),alert("Failed to download backup. Please try again.")}finally{w.value=!1}};return $(()=>{I()}),(o,e)=>{const r=z("tooltip");return i(),u(A,null,[d(l(q)),a("div",G,[a("div",K,[e[25]||(e[25]=a("h2",{class:"text-xl font-bold text-surface-900 dark:text-surface-0 mb-6"},"Company Information",-1)),a("form",{onSubmit:v(M,["prevent"]),class:"space-y-6"},[a("div",H,[a("div",Q,[e[12]||(e[12]=a("label",{for:"company_name",class:"text-sm font-medium text-surface-700 dark:text-surface-200"},"Company Name",-1)),d(l(c),{id:"company_name",modelValue:t.value.company_name,"onUpdate:modelValue":e[0]||(e[0]=s=>t.value.company_name=s)},null,8,["modelValue"])]),a("div",W,[e[13]||(e[13]=a("label",{for:"contact_name",class:"text-sm font-medium text-surface-700 dark:text-surface-200"},"Contact Name",-1)),d(l(c),{id:"contact_name",modelValue:t.value.contact_name,"onUpdate:modelValue":e[1]||(e[1]=s=>t.value.contact_name=s)},null,8,["modelValue"])]),a("div",Y,[e[14]||(e[14]=a("label",{for:"company_email",class:"text-sm font-medium text-surface-700 dark:text-surface-200"},"Email",-1)),d(l(c),{id:"company_email",type:"email",modelValue:t.value.email,"onUpdate:modelValue":e[2]||(e[2]=s=>t.value.email=s)},null,8,["modelValue"])]),a("div",J,[e[15]||(e[15]=a("label",{for:"company_phone",class:"text-sm font-medium text-surface-700 dark:text-surface-200"},"Phone",-1)),d(l(c),{id:"company_phone",modelValue:t.value.phone,"onUpdate:modelValue":e[3]||(e[3]=s=>t.value.phone=s)},null,8,["modelValue"])]),a("div",X,[e[16]||(e[16]=a("label",{for:"company_whatsapp",class:"text-sm font-medium text-surface-700 dark:text-surface-200"},"WhatsApp",-1)),d(l(c),{id:"company_whatsapp",modelValue:t.value.whatsapp,"onUpdate:modelValue":e[4]||(e[4]=s=>t.value.whatsapp=s)},null,8,["modelValue"])]),a("div",Z,[e[17]||(e[17]=a("label",{for:"gst_number",class:"text-sm font-medium text-surface-700 dark:text-surface-200"},"GST Number",-1)),d(l(c),{id:"gst_number",modelValue:t.value.gst_number,"onUpdate:modelValue":e[5]||(e[5]=s=>t.value.gst_number=s)},null,8,["modelValue"])]),a("div",ee,[e[18]||(e[18]=a("label",{for:"pan_number",class:"text-sm font-medium text-surface-700 dark:text-surface-200"},"PAN Number",-1)),d(l(c),{id:"pan_number",modelValue:t.value.pan_number,"onUpdate:modelValue":e[6]||(e[6]=s=>t.value.pan_number=s)},null,8,["modelValue"])]),a("div",ae,[e[19]||(e[19]=a("label",{for:"tan_number",class:"text-sm font-medium text-surface-700 dark:text-surface-200"},"TAN Number",-1)),d(l(c),{id:"tan_number",modelValue:t.value.tan_number,"onUpdate:modelValue":e[7]||(e[7]=s=>t.value.tan_number=s)},null,8,["modelValue"])]),a("div",te,[e[20]||(e[20]=a("label",{for:"license_number",class:"text-sm font-medium text-surface-700 dark:text-surface-200"},"License Number",-1)),d(l(c),{id:"license_number",modelValue:t.value.license_number,"onUpdate:modelValue":e[8]||(e[8]=s=>t.value.license_number=s)},null,8,["modelValue"])]),a("div",se,[e[23]||(e[23]=a("label",{for:"company_logo",class:"text-sm font-medium text-surface-700 dark:text-surface-200"},"Logo",-1)),a("div",{class:"relative flex flex-col items-center justify-center border-2 border-dashed border-surface-200 dark:border-surface-700 rounded-lg bg-surface-50 dark:bg-surface-900 py-4 px-4 cursor-pointer transition hover:bg-primary-50",onDragover:e[9]||(e[9]=v(()=>{},["prevent"])),onDrop:v(j,["prevent"])},[a("input",{type:"file",id:"company_logo",onChange:C,accept:"image/*",class:"absolute inset-0 opacity-0 cursor-pointer",style:{"z-index":"2"}},null,32),b.value?(i(),u("div",re,[a("img",{src:b.value,alt:"Logo preview",class:"h-20 object-contain rounded border border-surface-200 dark:border-surface-700 shadow"},null,8,oe),e[21]||(e[21]=a("span",{class:"text-xs text-surface-500 dark:text-surface-400"},"Preview",-1))])):(i(),u("div",le,[...e[22]||(e[22]=[a("i",{class:"pi pi-image text-4xl"},null,-1),a("span",{class:"text-xs"},"Drag & drop or click to upload",-1)])])),b.value?U((i(),y(l(_),{key:2,icon:"pi pi-times",text:"",severity:"danger",onClick:v(B,["stop"]),class:"absolute top-2 right-2"},null,512)),[[r,"Remove logo"]]):V("",!0)],32),x.value?(i(),u("div",ne,[a("span",null,m(x.value.name)+" ("+m((x.value.size/1024).toFixed(1))+" KB)",1)])):V("",!0)]),a("div",de,[e[24]||(e[24]=a("label",{for:"company_address",class:"text-sm font-medium text-surface-700 dark:text-surface-200"},"Address",-1)),d(l(O),{id:"company_address",modelValue:t.value.address,"onUpdate:modelValue":e[10]||(e[10]=s=>t.value.address=s),rows:"3"},null,8,["modelValue"])])]),a("div",ie,[d(l(_),{type:"submit",label:"Save Company Info",loading:h.value},null,8,["loading"])])],32)]),a("div",ue,[e[37]||(e[37]=T('<div class="grid grid-cols-[auto_1fr] items-center gap-4 mb-6"><div class="w-12 h-12 rounded-xl bg-purple-50 dark:bg-purple-500/10 flex items-center justify-center"><i class="pi pi-verified text-purple-500 text-xl"></i></div><div><h3 class="text-lg font-semibold text-surface-900 dark:text-surface-0 m-0 leading-tight">License Information</h3><p class="text-surface-500 dark:text-surface-400 text-sm mt-1 mb-0">AuditFlow Application License Details</p></div></div>',1)),n.value?(i(),u("div",ce,[!n.value.is_valid&&n.value.error?(i(),u("div",pe,[e[26]||(e[26]=a("i",{class:"pi pi-exclamation-triangle mr-2"},null,-1)),k(" "+m(n.value.error),1)])):V("",!0),a("div",me,[a("div",fe,[e[27]||(e[27]=a("span",{class:"text-xs font-semibold text-surface-500 dark:text-surface-400 uppercase tracking-wider"},"Licensed To",-1)),a("div",xe,m(n.value.issued_to||"N/A"),1)]),e[30]||(e[30]=a("div",{class:"p-4 bg-surface-50 dark:bg-surface-900 rounded-lg border border-surface-100 dark:border-surface-700"},[a("span",{class:"text-xs font-semibold text-surface-500 dark:text-surface-400 uppercase tracking-wider"},"Licensed From"),a("div",{class:"text-lg font-bold text-surface-900 dark:text-surface-0 mt-1"},"Klock Technologies")],-1)),a("div",be,[e[28]||(e[28]=a("span",{class:"text-xs font-semibold text-surface-500 dark:text-surface-400 uppercase tracking-wider"},"Expiry Date",-1)),a("div",ge,[a("div",ve,m(n.value.expires_at?new Date(n.value.expires_at).toLocaleDateString():"N/A"),1),n.value.is_valid?(i(),y(l(L),{key:0,value:"Active",severity:"success"})):(i(),y(l(L),{key:1,value:"Expired",severity:"danger"}))])]),a("div",ye,[e[29]||(e[29]=a("span",{class:"text-xs font-semibold text-surface-500 dark:text-surface-400 uppercase tracking-wider"},"License ID / Hash",-1)),a("div",_e,m(n.value.license_id||"N/A"),1)])]),a("div",ke,[e[33]||(e[33]=a("span",{class:"text-xs font-semibold text-surface-500 dark:text-surface-400 uppercase tracking-wider"},"Machine Lock",-1)),n.value.machine_id?(i(),u("div",we,[e[31]||(e[31]=a("i",{class:"pi pi-lock text-primary-500"},null,-1)),k(" "+m(n.value.machine_id),1)])):(i(),u("div",he,[...e[32]||(e[32]=[a("i",{class:"pi pi-unlock text-surface-400"},null,-1),k(" Not hardware locked ",-1)])]))]),a("div",Ve,[a("div",De,[e[35]||(e[35]=a("div",{class:"w-10 h-10 rounded-lg bg-primary-100 dark:bg-primary-900/30 flex items-center justify-center"},[a("i",{class:"pi pi-desktop text-primary-600 dark:text-primary-400"})],-1)),a("div",null,[e[34]||(e[34]=a("span",{class:"text-xs font-semibold text-primary-700 dark:text-primary-300 uppercase tracking-wider"},"Your Machine ID",-1)),a("div",Le,m(n.value.current_machine_id||"Generating..."),1)])]),U(d(l(_),{icon:"pi pi-copy",text:"",rounded:"",onClick:e[11]||(e[11]=s=>F(n.value.current_machine_id)),class:"text-primary-600 dark:text-primary-400"},null,512),[[r,"Copy Machine ID"]])]),a("div",Ce,[(i(!0),u(A,null,R(n.value.features,s=>(i(),y(l(L),{key:s,value:s==="*"?"Full Access":s,severity:"info",outlined:""},null,8,["value"]))),128))])])):(i(),u("div",Ne,[...e[36]||(e[36]=[a("i",{class:"pi pi-spin pi-spinner mr-2"},null,-1),k(" Loading license details... ",-1)])]))]),a("div",Ue,[e[39]||(e[39]=T('<div class="grid grid-cols-[auto_1fr] items-center gap-4 mb-6"><div class="w-12 h-12 rounded-xl bg-blue-50 dark:bg-blue-500/10 flex items-center justify-center"><i class="pi pi-database text-blue-500 text-xl"></i></div><div><h3 class="text-lg font-semibold text-surface-900 dark:text-surface-0 m-0 leading-tight">Database Management</h3><p class="text-surface-500 dark:text-surface-400 text-sm mt-1 mb-0">Manage your application data backups.</p></div></div>',1)),a("div",Te,[a("div",Ae,[e[38]||(e[38]=a("div",null,[a("h4",{class:"font-medium text-surface-900 dark:text-surface-0 m-0 text-base"},"Backup Database"),a("p",{class:"text-sm text-surface-500 dark:text-surface-400 mt-1 mb-0"},"Download a full SQL dump")],-1)),d(l(_),{label:"Download",icon:"pi pi-download",loading:w.value,onClick:E,severity:"secondary",outlined:""},null,8,["loading"])])])])])],64)}}};export{Ee as default};
