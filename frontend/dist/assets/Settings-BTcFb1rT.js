import{r as d,u as R,k as z,c as g,b as r,a,f as n,y as k,n as u,d as U,w as K,B as I,s as _,t as x,C,A as $,q,g as b,m as G,o as p}from"./index-CERIRcW2.js";import{s as O}from"./index-BdTjmT_3.js";import{s as S}from"./index-BSCWIYhD.js";import"./index-CUPv0TyI.js";const Q={class:"max-w-4xl mx-auto space-y-6"},W={class:"card bg-white dark:bg-surface-800 rounded-xl shadow-sm p-6"},H={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},J={class:"flex flex-col gap-2"},X={class:"flex flex-col gap-2"},Y={class:"flex flex-col gap-2"},Z={class:"flex flex-col gap-2"},ee={class:"flex flex-col gap-2"},ae={class:"flex flex-col gap-2"},se={class:"flex flex-col gap-2"},te={class:"flex flex-col gap-2"},le={class:"flex flex-col gap-2"},oe={class:"flex flex-col gap-2"},ne={key:0,class:"flex flex-col items-center gap-2"},re=["src"],de={key:1,class:"flex flex-col items-center gap-2 text-surface-400"},ie={key:0,class:"mt-2 text-xs text-surface-500 dark:text-surface-400"},ue={class:"flex flex-col gap-2 md:col-span-2"},ce={class:"flex justify-end"},me={class:"card bg-white dark:bg-surface-800 rounded-xl shadow-sm p-6 border border-surface-200 dark:border-surface-700"},pe={class:"space-y-6"},fe={class:"flex flex-col md:flex-row md:items-center justify-between p-4 bg-surface-50 dark:bg-surface-900 rounded-xl border border-surface-100 dark:border-surface-700 gap-4"},ve={class:"flex items-center gap-4"},ge={class:"font-medium text-surface-900 dark:text-surface-0 m-0 text-base"},xe={key:0,class:"text-sm text-surface-500 dark:text-surface-400 mt-1 mb-0"},be={key:1,class:"text-sm text-surface-500 dark:text-surface-400 mt-1 mb-0"},ye={class:"flex flex-col gap-2"},_e={class:"flex flex-col gap-3"},ke={class:"flex justify-end gap-2"},we={class:"card bg-white dark:bg-surface-800 rounded-xl shadow-sm p-6 border border-surface-200 dark:border-surface-700"},he={class:"space-y-4"},Ve={class:"flex items-center justify-between p-4 bg-surface-50 dark:bg-surface-900 rounded-xl border border-surface-100 dark:border-surface-700 gap-4"},Ee={__name:"Settings",setup(Le){const w=d(!1);d(!1);const h=d(!1),V=d(!1),i=R(),c=d({status:"loading",is_valid:!1,message:"",expires_at:null,remaining_days:0}),f=d(""),E=d({whatsapp_access_token:"",whatsapp_phone_number_id:"",whatsapp_business_account_id:""}),s=d({company_name:"",contact_name:"",email:"",phone:"",whatsapp:"",address:"",logo:"",gst_number:"",pan_number:"",tan_number:"",license_number:""}),v=d(""),m=d(null);function B(){v.value="",m.value=null}function F(l){const e=l.dataTransfer.files[0];e&&L({target:{files:[e]}})}const N=async()=>{try{const e=(await b.get("/settings")).data;E.value={whatsapp_access_token:e.whatsapp_access_token||"",whatsapp_phone_number_id:e.whatsapp_phone_number_id||"",whatsapp_business_account_id:e.whatsapp_business_account_id||""},s.value={company_name:e.company_name||"",contact_name:e.company_contact_name||"",email:e.company_email||"",phone:e.company_phone||"",whatsapp:e.company_whatsapp||"",address:e.company_address||"",logo:e.company_logo||"",gst_number:e.gst_number||"",pan_number:e.pan_number||"",tan_number:e.tan_number||"",license_number:e.license_number||""},s.value.logo&&(v.value=`http://localhost:8080/storage/${s.value.logo}`)}catch(l){console.error("Error fetching settings:",l),i.add({severity:"error",summary:"Error",detail:"Failed to load settings",life:3e3})}},L=l=>{const e=l.target.files[0];if(e){if(e.size>10485760){i.add({severity:"error",summary:"File Too Large",detail:"The logo file is too large. Please upload an image smaller than 10MB.",life:5e3}),l.target.value="";return}m.value=e;const o=new FileReader;o.onload=y=>{v.value=y.target.result},o.readAsDataURL(e)}},T=async()=>{var l,e;h.value=!0;try{const t=new FormData;t.append("company_name",s.value.company_name),t.append("company_contact_name",s.value.contact_name),t.append("company_email",s.value.email),t.append("company_phone",s.value.phone),t.append("company_whatsapp",s.value.whatsapp),t.append("company_address",s.value.address),t.append("gst_number",s.value.gst_number),t.append("pan_number",s.value.pan_number),t.append("tan_number",s.value.tan_number),t.append("license_number",s.value.license_number),m.value&&t.append("company_logo",m.value),await b.post("/settings",t,{headers:{"Content-Type":"multipart/form-data"}}),i.add({severity:"success",summary:"Success",detail:"Company information saved successfully",life:3e3})}catch(t){console.error("Error saving company info:",t),((l=t.response)==null?void 0:l.status)===413?i.add({severity:"error",summary:"File Too Large",detail:"The logo file is too large. Please upload an image smaller than 10MB.",life:5e3}):((e=t.response)==null?void 0:e.status)===422?i.add({severity:"error",summary:"Validation Error",detail:"Please check your input and try again.",life:3e3}):i.add({severity:"error",summary:"Error",detail:"Failed to save company information. Please try again.",life:3e3})}finally{h.value=!1}},j=async()=>{w.value=!0;try{const l=await b.get("/backup/download",{responseType:"blob"}),e=window.URL.createObjectURL(new Blob([l.data])),t=document.createElement("a");t.href=e;const o=l.headers["content-disposition"];let y="backup.sql";if(o){const D=o.match(/filename="?([^"]+)"?/);D.length===2&&(y=D[1])}else y=`backup-${new Date().toISOString().slice(0,19).replace(/:/g,"-")}.sql`;t.setAttribute("download",y),document.body.appendChild(t),t.click(),document.body.removeChild(t),window.URL.revokeObjectURL(e)}catch(l){console.error("Backup download failed:",l),alert("Failed to download backup. Please try again.")}finally{w.value=!1}},M=async()=>{try{const l=await b.get("/license/status");c.value=l.data}catch(l){console.error("Error fetching license status:",l)}},P=async()=>{var l,e;V.value=!0;try{const t=await b.post("/license/update",{license_key:f.value});i.add({severity:"success",summary:"Success",detail:"License updated successfully",life:3e3}),c.value=t.data.license,f.value=""}catch(t){console.error("Error updating license:",t),i.add({severity:"error",summary:"Error",detail:((e=(l=t.response)==null?void 0:l.data)==null?void 0:e.message)||"Failed to update license",life:3e3})}finally{V.value=!1}},A=async()=>{try{const l=await b.post("/license/generate",{years:2});f.value=l.data.license_key,i.add({severity:"info",summary:"Dev Mode",detail:"Generated a 2-year test key",life:3e3})}catch(l){console.error("Error generating dev key:",l)}};return z(()=>{N(),M()}),(l,e)=>{const t=G("tooltip");return p(),g(q,null,[r(n(O)),a("div",Q,[a("div",W,[e[25]||(e[25]=a("h2",{class:"text-xl font-bold text-surface-900 dark:text-surface-0 mb-6"},"Company Information",-1)),a("form",{onSubmit:k(T,["prevent"]),class:"space-y-6"},[a("div",H,[a("div",J,[e[12]||(e[12]=a("label",{for:"company_name",class:"text-sm font-medium text-surface-700 dark:text-surface-200"},"Company Name",-1)),r(n(u),{id:"company_name",modelValue:s.value.company_name,"onUpdate:modelValue":e[0]||(e[0]=o=>s.value.company_name=o)},null,8,["modelValue"])]),a("div",X,[e[13]||(e[13]=a("label",{for:"contact_name",class:"text-sm font-medium text-surface-700 dark:text-surface-200"},"Contact Name",-1)),r(n(u),{id:"contact_name",modelValue:s.value.contact_name,"onUpdate:modelValue":e[1]||(e[1]=o=>s.value.contact_name=o)},null,8,["modelValue"])]),a("div",Y,[e[14]||(e[14]=a("label",{for:"company_email",class:"text-sm font-medium text-surface-700 dark:text-surface-200"},"Email",-1)),r(n(u),{id:"company_email",type:"email",modelValue:s.value.email,"onUpdate:modelValue":e[2]||(e[2]=o=>s.value.email=o)},null,8,["modelValue"])]),a("div",Z,[e[15]||(e[15]=a("label",{for:"company_phone",class:"text-sm font-medium text-surface-700 dark:text-surface-200"},"Phone",-1)),r(n(u),{id:"company_phone",modelValue:s.value.phone,"onUpdate:modelValue":e[3]||(e[3]=o=>s.value.phone=o)},null,8,["modelValue"])]),a("div",ee,[e[16]||(e[16]=a("label",{for:"company_whatsapp",class:"text-sm font-medium text-surface-700 dark:text-surface-200"},"WhatsApp",-1)),r(n(u),{id:"company_whatsapp",modelValue:s.value.whatsapp,"onUpdate:modelValue":e[4]||(e[4]=o=>s.value.whatsapp=o)},null,8,["modelValue"])]),a("div",ae,[e[17]||(e[17]=a("label",{for:"gst_number",class:"text-sm font-medium text-surface-700 dark:text-surface-200"},"GST Number",-1)),r(n(u),{id:"gst_number",modelValue:s.value.gst_number,"onUpdate:modelValue":e[5]||(e[5]=o=>s.value.gst_number=o)},null,8,["modelValue"])]),a("div",se,[e[18]||(e[18]=a("label",{for:"pan_number",class:"text-sm font-medium text-surface-700 dark:text-surface-200"},"PAN Number",-1)),r(n(u),{id:"pan_number",modelValue:s.value.pan_number,"onUpdate:modelValue":e[6]||(e[6]=o=>s.value.pan_number=o)},null,8,["modelValue"])]),a("div",te,[e[19]||(e[19]=a("label",{for:"tan_number",class:"text-sm font-medium text-surface-700 dark:text-surface-200"},"TAN Number",-1)),r(n(u),{id:"tan_number",modelValue:s.value.tan_number,"onUpdate:modelValue":e[7]||(e[7]=o=>s.value.tan_number=o)},null,8,["modelValue"])]),a("div",le,[e[20]||(e[20]=a("label",{for:"license_number",class:"text-sm font-medium text-surface-700 dark:text-surface-200"},"License Number",-1)),r(n(u),{id:"license_number",modelValue:s.value.license_number,"onUpdate:modelValue":e[8]||(e[8]=o=>s.value.license_number=o)},null,8,["modelValue"])]),a("div",oe,[e[23]||(e[23]=a("label",{for:"company_logo",class:"text-sm font-medium text-surface-700 dark:text-surface-200"},"Logo",-1)),a("div",{class:"relative flex flex-col items-center justify-center border-2 border-dashed border-surface-200 dark:border-surface-700 rounded-lg bg-surface-50 dark:bg-surface-900 py-4 px-4 cursor-pointer transition hover:bg-primary-50",onDragover:e[9]||(e[9]=k(()=>{},["prevent"])),onDrop:k(F,["prevent"])},[a("input",{type:"file",id:"company_logo",onChange:L,accept:"image/*",class:"absolute inset-0 opacity-0 cursor-pointer",style:{"z-index":"2"}},null,32),v.value?(p(),g("div",ne,[a("img",{src:v.value,alt:"Logo preview",class:"h-20 object-contain rounded border border-surface-200 dark:border-surface-700 shadow"},null,8,re),e[21]||(e[21]=a("span",{class:"text-xs text-surface-500 dark:text-surface-400"},"Preview",-1))])):(p(),g("div",de,[...e[22]||(e[22]=[a("i",{class:"pi pi-image text-4xl"},null,-1),a("span",{class:"text-xs"},"Drag & drop or click to upload",-1)])])),v.value?K((p(),I(n(_),{key:2,icon:"pi pi-times",text:"",severity:"danger",onClick:k(B,["stop"]),class:"absolute top-2 right-2"},null,512)),[[t,"Remove logo"]]):U("",!0)],32),m.value?(p(),g("div",ie,[a("span",null,x(m.value.name)+" ("+x((m.value.size/1024).toFixed(1))+" KB)",1)])):U("",!0)]),a("div",ue,[e[24]||(e[24]=a("label",{for:"company_address",class:"text-sm font-medium text-surface-700 dark:text-surface-200"},"Address",-1)),r(n(S),{id:"company_address",modelValue:s.value.address,"onUpdate:modelValue":e[10]||(e[10]=o=>s.value.address=o),rows:"3"},null,8,["modelValue"])])]),a("div",ce,[r(n(_),{type:"submit",label:"Save Company Info",loading:h.value},null,8,["loading"])])],32)]),a("div",me,[e[27]||(e[27]=C('<div class="grid grid-cols-[auto_1fr] items-center gap-4 mb-6"><div class="w-12 h-12 rounded-xl bg-purple-50 dark:bg-purple-500/10 flex items-center justify-center"><i class="pi pi-key text-purple-500 text-xl"></i></div><div><h3 class="text-lg font-semibold text-surface-900 dark:text-surface-0 m-0 leading-tight">Application Licensed with Klock Techlogies</h3><p class="text-surface-500 dark:text-surface-400 text-sm mt-1 mb-0">Manage your AuditFlow application license.</p></div></div>',1)),a("div",pe,[a("div",fe,[a("div",ve,[a("div",{class:$(["w-3 h-3 rounded-full",c.value.is_valid?"bg-green-500":"bg-red-500"])},null,2),a("div",null,[a("h4",ge,"Status: "+x(c.value.status),1),c.value.expires_at?(p(),g("p",xe," Expires on: "+x(new Date(c.value.expires_at).toLocaleDateString())+" ("+x(Math.floor(c.value.remaining_days))+" days remaining) ",1)):(p(),g("p",be,x(c.value.message),1))])])]),a("div",ye,[e[26]||(e[26]=a("label",{for:"update_license",class:"text-sm font-medium text-surface-700 dark:text-surface-200"},"Update License Key",-1)),a("div",_e,[r(n(S),{id:"update_license",modelValue:f.value,"onUpdate:modelValue":e[11]||(e[11]=o=>f.value=o),rows:"3",placeholder:"Paste your new license key here"},null,8,["modelValue"]),a("div",ke,[r(n(_),{label:"Generate Key (Dev)",severity:"secondary",onClick:A,text:""}),r(n(_),{label:"Update License",loading:V.value,disabled:!f.value,onClick:P},null,8,["loading","disabled"])])])])])]),a("div",we,[e[29]||(e[29]=C('<div class="grid grid-cols-[auto_1fr] items-center gap-4 mb-6"><div class="w-12 h-12 rounded-xl bg-blue-50 dark:bg-blue-500/10 flex items-center justify-center"><i class="pi pi-database text-blue-500 text-xl"></i></div><div><h3 class="text-lg font-semibold text-surface-900 dark:text-surface-0 m-0 leading-tight">Database Management</h3><p class="text-surface-500 dark:text-surface-400 text-sm mt-1 mb-0">Manage your application data backups.</p></div></div>',1)),a("div",he,[a("div",Ve,[e[28]||(e[28]=a("div",null,[a("h4",{class:"font-medium text-surface-900 dark:text-surface-0 m-0 text-base"},"Backup Database"),a("p",{class:"text-sm text-surface-500 dark:text-surface-400 mt-1 mb-0"},"Download a full SQL dump")],-1)),r(n(_),{label:"Download",icon:"pi pi-download",loading:w.value,onClick:j,severity:"secondary",outlined:""},null,8,["loading"])])])])])],64)}}};export{Ee as default};
