import{r as v,o as I,b as d,f as a,x as N,d as n,e as r,g as i,t as c,n as _,i as U,s as b,h as p,j as u}from"./index-BZGgFshJ.js";import{s as V}from"./index-96xtCJkb.js";import{s as $}from"./index-DA80Fo-P.js";import{s as g}from"./index-CcGyZ6li.js";import"./index-D5pn4_TF.js";import"./index-1NqfiXxy.js";const S={class:"max-w-2xl mx-auto space-y-6"},D={class:"card bg-white dark:bg-surface-800 rounded-xl shadow-sm p-6"},q={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},F={class:"flex flex-col gap-2"},E={key:0,class:"text-red-500"},h={class:"flex flex-col gap-2"},B={key:0,class:"text-red-500"},R={class:"flex flex-col gap-2"},T={key:0,class:"text-red-500"},j={class:"flex flex-col gap-2"},A={key:0,class:"text-red-500"},L={class:"flex flex-col gap-2"},M={key:0,class:"text-red-500"},O={class:"flex flex-col gap-2"},z={key:0,class:"text-red-500"},G={class:"flex flex-col gap-2"},H={key:0,class:"text-red-500"},J={class:"flex flex-col gap-2 md:col-span-2"},K={key:0,class:"text-red-500"},P={class:"flex justify-end gap-3"},te={__name:"InvoiceForm",setup(Q){const x=U(),f=v(!1),y=v([]),m=v([]),t=v({client_id:null,file_id:null,invoice_number:`INV-${Date.now()}`,invoice_date:new Date().toISOString().split("T")[0],due_date:"",total_tax_amount:null,auditor_fee:null,notes:""}),l=v({}),k=async()=>{try{const s=await p.get("/clients");y.value=s.data}catch(s){console.error("Error fetching clients:",s)}},w=async()=>{if(t.value.client_id)try{const s=await p.get("/files",{params:{client_id:t.value.client_id}});m.value=s.data.map(e=>({...e,file_display:`${e.file_type} - ${e.assessment_year}`}))}catch(s){console.error("Error fetching client files:",s),m.value=[]}else m.value=[];t.value.file_id=null},C=async()=>{var s;f.value=!0,l.value={};try{await p.post("/invoices",t.value),x.push("/billing")}catch(e){console.error("Error creating invoice:",e),((s=e.response)==null?void 0:s.status)===422&&(l.value=e.response.data.errors||{})}finally{f.value=!1}};return I(()=>{k()}),(s,e)=>(u(),d("div",S,[a("div",D,[a("form",{onSubmit:N(C,["prevent"]),class:"space-y-6"},[a("div",q,[a("div",F,[e[9]||(e[9]=a("label",{for:"client",class:"text-sm font-medium text-surface-700 dark:text-surface-200"},"Client",-1)),n(i(g),{id:"client",modelValue:t.value.client_id,"onUpdate:modelValue":e[0]||(e[0]=o=>t.value.client_id=o),options:y.value,optionLabel:"business_name",optionValue:"id",placeholder:"Select Client",filter:"",required:"",class:"w-full",invalid:!!l.value.client_id,onChange:w},null,8,["modelValue","options","invalid"]),l.value.client_id?(u(),d("small",E,c(l.value.client_id[0]),1)):r("",!0)]),a("div",h,[e[10]||(e[10]=a("label",{for:"file",class:"text-sm font-medium text-surface-700 dark:text-surface-200"},"File",-1)),n(i(g),{id:"file",modelValue:t.value.file_id,"onUpdate:modelValue":e[1]||(e[1]=o=>t.value.file_id=o),options:m.value,optionLabel:"file_display",optionValue:"id",placeholder:"Select File",filter:"",class:"w-full",invalid:!!l.value.file_id,disabled:!t.value.client_id},null,8,["modelValue","options","invalid","disabled"]),l.value.file_id?(u(),d("small",B,c(l.value.file_id[0]),1)):r("",!0)]),a("div",R,[e[11]||(e[11]=a("label",{for:"invoice_number",class:"text-sm font-medium text-surface-700 dark:text-surface-200"},"Invoice #",-1)),n(i(_),{id:"invoice_number",modelValue:t.value.invoice_number,"onUpdate:modelValue":e[2]||(e[2]=o=>t.value.invoice_number=o),required:"",invalid:!!l.value.invoice_number},null,8,["modelValue","invalid"]),l.value.invoice_number?(u(),d("small",T,c(l.value.invoice_number[0]),1)):r("",!0)]),a("div",j,[e[12]||(e[12]=a("label",{for:"invoice_date",class:"text-sm font-medium text-surface-700 dark:text-surface-200"},"Invoice Date",-1)),n(i(_),{id:"invoice_date",type:"date",modelValue:t.value.invoice_date,"onUpdate:modelValue":e[3]||(e[3]=o=>t.value.invoice_date=o),required:"",invalid:!!l.value.invoice_date},null,8,["modelValue","invalid"]),l.value.invoice_date?(u(),d("small",A,c(l.value.invoice_date[0]),1)):r("",!0)]),a("div",L,[e[13]||(e[13]=a("label",{for:"due_date",class:"text-sm font-medium text-surface-700 dark:text-surface-200"},"Due Date",-1)),n(i(_),{id:"due_date",type:"date",modelValue:t.value.due_date,"onUpdate:modelValue":e[4]||(e[4]=o=>t.value.due_date=o),required:"",invalid:!!l.value.due_date},null,8,["modelValue","invalid"]),l.value.due_date?(u(),d("small",M,c(l.value.due_date[0]),1)):r("",!0)]),a("div",O,[e[14]||(e[14]=a("label",{for:"total_tax_amount",class:"text-sm font-medium text-surface-700 dark:text-surface-200"},"Total Tax Amount",-1)),n(i(V),{id:"total_tax_amount",modelValue:t.value.total_tax_amount,"onUpdate:modelValue":e[5]||(e[5]=o=>t.value.total_tax_amount=o),mode:"currency",currency:"INR",locale:"en-IN",class:"w-full",invalid:!!l.value.total_tax_amount},null,8,["modelValue","invalid"]),l.value.total_tax_amount?(u(),d("small",z,c(l.value.total_tax_amount[0]),1)):r("",!0)]),a("div",G,[e[15]||(e[15]=a("label",{for:"auditor_fee",class:"text-sm font-medium text-surface-700 dark:text-surface-200"},"Auditor Fee",-1)),n(i(V),{id:"auditor_fee",modelValue:t.value.auditor_fee,"onUpdate:modelValue":e[6]||(e[6]=o=>t.value.auditor_fee=o),mode:"currency",currency:"INR",locale:"en-IN",required:"",class:"w-full",invalid:!!l.value.auditor_fee},null,8,["modelValue","invalid"]),l.value.auditor_fee?(u(),d("small",H,c(l.value.auditor_fee[0]),1)):r("",!0)]),a("div",J,[e[16]||(e[16]=a("label",{for:"notes",class:"text-sm font-medium text-surface-700 dark:text-surface-200"},"Notes",-1)),n(i($),{id:"notes",modelValue:t.value.notes,"onUpdate:modelValue":e[7]||(e[7]=o=>t.value.notes=o),rows:"3",invalid:!!l.value.notes},null,8,["modelValue","invalid"]),l.value.notes?(u(),d("small",K,c(l.value.notes[0]),1)):r("",!0)])]),a("div",P,[n(i(b),{label:"Cancel",severity:"secondary",onClick:e[8]||(e[8]=o=>i(x).back())}),n(i(b),{type:"submit",label:"Create Invoice",loading:f.value},null,8,["loading"])])],32)])]))}};export{te as default};
